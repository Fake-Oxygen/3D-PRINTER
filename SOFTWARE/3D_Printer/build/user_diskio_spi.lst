ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 6
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"user_diskio_spi.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.section	.bss.msg_buffer,"aw",%nobits
  20              		.align	2
  23              	msg_buffer:
  24 0000 00000000 		.space	30
  24      00000000 
  24      00000000 
  24      00000000 
  24      00000000 
  25              		.section	.bss.RxBuf,"aw",%nobits
  26              		.align	2
  29              	RxBuf:
  30 0000 00000000 		.space	40
  30      00000000 
  30      00000000 
  30      00000000 
  30      00000000 
  31              		.section	.data.Stat,"aw"
  34              	Stat:
  35 0000 01       		.byte	1
  36              		.section	.bss.CardType,"aw",%nobits
  39              	CardType:
  40 0000 00       		.space	1
  41              		.global	spiTimerTickStart
  42              		.section	.bss.spiTimerTickStart,"aw",%nobits
  43              		.align	2
  46              	spiTimerTickStart:
  47 0000 00000000 		.space	4
  48              		.global	spiTimerTickDelay
  49              		.section	.bss.spiTimerTickDelay,"aw",%nobits
  50              		.align	2
  53              	spiTimerTickDelay:
  54 0000 00000000 		.space	4
  55              		.section	.text.SPI_Timer_On,"ax",%progbits
  56              		.align	1
  57              		.global	SPI_Timer_On
  58              		.syntax unified
  59              		.thumb
  60              		.thumb_func
  62              	SPI_Timer_On:
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 2


  63              	.LFB321:
  64              		.file 1 "FATFS/Target/user_diskio_spi.c"
   1:FATFS/Target/user_diskio_spi.c **** /**
   2:FATFS/Target/user_diskio_spi.c ****  ******************************************************************************
   3:FATFS/Target/user_diskio_spi.c ****   * @file    user_diskio_spi.c
   4:FATFS/Target/user_diskio_spi.c ****   * @brief   This file contains the implementation of the user_diskio_spi FatFs
   5:FATFS/Target/user_diskio_spi.c ****   *          driver.
   6:FATFS/Target/user_diskio_spi.c ****   ******************************************************************************
   7:FATFS/Target/user_diskio_spi.c ****   * Portions copyright (C) 2014, ChaN, all rights reserved.
   8:FATFS/Target/user_diskio_spi.c ****   * Portions copyright (C) 2017, kiwih, all rights reserved.
   9:FATFS/Target/user_diskio_spi.c ****   *
  10:FATFS/Target/user_diskio_spi.c ****   * This software is a free software and there is NO WARRANTY.
  11:FATFS/Target/user_diskio_spi.c ****   * No restriction on use. You can use, modify and redistribute it for
  12:FATFS/Target/user_diskio_spi.c ****   * personal, non-profit or commercial products UNDER YOUR RESPONSIBILITY.
  13:FATFS/Target/user_diskio_spi.c ****   * Redistributions of source code must retain the above copyright notice.
  14:FATFS/Target/user_diskio_spi.c ****   *
  15:FATFS/Target/user_diskio_spi.c ****   ******************************************************************************
  16:FATFS/Target/user_diskio_spi.c ****   */
  17:FATFS/Target/user_diskio_spi.c **** 
  18:FATFS/Target/user_diskio_spi.c **** //This code was ported by kiwih from a copywrited (C) library written by ChaN
  19:FATFS/Target/user_diskio_spi.c **** //available at http://elm-chan.org/fsw/ff/ffsample.zip
  20:FATFS/Target/user_diskio_spi.c **** //(text at http://elm-chan.org/fsw/ff/00index_e.html)
  21:FATFS/Target/user_diskio_spi.c **** 
  22:FATFS/Target/user_diskio_spi.c **** //This file provides the FatFs driver functions and SPI code required to manage
  23:FATFS/Target/user_diskio_spi.c **** //an SPI-connected MMC or compatible SD card with FAT
  24:FATFS/Target/user_diskio_spi.c **** 
  25:FATFS/Target/user_diskio_spi.c **** //It is designed to be wrapped by a cubemx generated user_diskio.c file.
  26:FATFS/Target/user_diskio_spi.c **** 
  27:FATFS/Target/user_diskio_spi.c **** #include "stm32l4xx_hal.h" /* Provide the low-level HAL functions */
  28:FATFS/Target/user_diskio_spi.c **** #include "user_diskio_spi.h"
  29:FATFS/Target/user_diskio_spi.c **** 
  30:FATFS/Target/user_diskio_spi.c **** //Make sure you set #define SD_SPI_HANDLE as some hspix in main.h
  31:FATFS/Target/user_diskio_spi.c **** //Make sure you set #define SD_CS_GPIO_Port as some GPIO port in main.h
  32:FATFS/Target/user_diskio_spi.c **** //Make sure you set #define SD_CS_Pin as some GPIO pin in main.h
  33:FATFS/Target/user_diskio_spi.c **** extern SPI_HandleTypeDef SD_SPI_HANDLE;
  34:FATFS/Target/user_diskio_spi.c **** 
  35:FATFS/Target/user_diskio_spi.c **** /* Function prototypes */
  36:FATFS/Target/user_diskio_spi.c **** 
  37:FATFS/Target/user_diskio_spi.c **** //(Note that the _256 is used as a mask to clear the prescalar bits as it provides binary 111 in th
  38:FATFS/Target/user_diskio_spi.c **** #define FCLK_SLOW() { MODIFY_REG(SD_SPI_HANDLE.Instance->CR1, SPI_BAUDRATEPRESCALER_256, SPI_BAUDRA
  39:FATFS/Target/user_diskio_spi.c **** #define FCLK_FAST() { MODIFY_REG(SD_SPI_HANDLE.Instance->CR1, SPI_BAUDRATEPRESCALER_256, SPI_BAUDRA
  40:FATFS/Target/user_diskio_spi.c **** 
  41:FATFS/Target/user_diskio_spi.c **** #define CS_HIGH()	{HAL_GPIO_WritePin(SD_CS_GPIO_Port, SD_CS_Pin, GPIO_PIN_SET);}
  42:FATFS/Target/user_diskio_spi.c **** #define CS_LOW()	{HAL_GPIO_WritePin(SD_CS_GPIO_Port, SD_CS_Pin, GPIO_PIN_RESET);}
  43:FATFS/Target/user_diskio_spi.c **** 
  44:FATFS/Target/user_diskio_spi.c **** /*--------------------------------------------------------------------------
  45:FATFS/Target/user_diskio_spi.c **** 
  46:FATFS/Target/user_diskio_spi.c ****    Module Private Functions
  47:FATFS/Target/user_diskio_spi.c **** 
  48:FATFS/Target/user_diskio_spi.c **** ---------------------------------------------------------------------------*/
  49:FATFS/Target/user_diskio_spi.c **** 
  50:FATFS/Target/user_diskio_spi.c **** /* MMC/SD command */
  51:FATFS/Target/user_diskio_spi.c **** #define CMD0	(0)			/* GO_IDLE_STATE */
  52:FATFS/Target/user_diskio_spi.c **** #define CMD1	(1)			/* SEND_OP_COND (MMC) */
  53:FATFS/Target/user_diskio_spi.c **** #define	ACMD41	(0x80+41)	/* SEND_OP_COND (SDC) */
  54:FATFS/Target/user_diskio_spi.c **** #define CMD8	(8)			/* SEND_IF_COND */
  55:FATFS/Target/user_diskio_spi.c **** #define CMD9	(9)			/* SEND_CSD */
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 3


  56:FATFS/Target/user_diskio_spi.c **** #define CMD10	(10)		/* SEND_CID */
  57:FATFS/Target/user_diskio_spi.c **** #define CMD12	(12)		/* STOP_TRANSMISSION */
  58:FATFS/Target/user_diskio_spi.c **** #define ACMD13	(0x80+13)	/* SD_STATUS (SDC) */
  59:FATFS/Target/user_diskio_spi.c **** #define CMD16	(16)		/* SET_BLOCKLEN */
  60:FATFS/Target/user_diskio_spi.c **** #define CMD17	(17)		/* READ_SINGLE_BLOCK */
  61:FATFS/Target/user_diskio_spi.c **** #define CMD18	(18)		/* READ_MULTIPLE_BLOCK */
  62:FATFS/Target/user_diskio_spi.c **** #define CMD23	(23)		/* SET_BLOCK_COUNT (MMC) */
  63:FATFS/Target/user_diskio_spi.c **** #define	ACMD23	(0x80+23)	/* SET_WR_BLK_ERASE_COUNT (SDC) */
  64:FATFS/Target/user_diskio_spi.c **** #define CMD24	(24)		/* WRITE_BLOCK */
  65:FATFS/Target/user_diskio_spi.c **** #define CMD25	(25)		/* WRITE_MULTIPLE_BLOCK */
  66:FATFS/Target/user_diskio_spi.c **** #define CMD32	(32)		/* ERASE_ER_BLK_START */
  67:FATFS/Target/user_diskio_spi.c **** #define CMD33	(33)		/* ERASE_ER_BLK_END */
  68:FATFS/Target/user_diskio_spi.c **** #define CMD38	(38)		/* ERASE */
  69:FATFS/Target/user_diskio_spi.c **** #define CMD55	(55)		/* APP_CMD */
  70:FATFS/Target/user_diskio_spi.c **** #define CMD58	(58)		/* READ_OCR */
  71:FATFS/Target/user_diskio_spi.c **** 
  72:FATFS/Target/user_diskio_spi.c **** /* MMC card type flags (MMC_GET_TYPE) */
  73:FATFS/Target/user_diskio_spi.c **** #define CT_MMC		0x01		/* MMC ver 3 */
  74:FATFS/Target/user_diskio_spi.c **** #define CT_SD1		0x02		/* SD ver 1 */
  75:FATFS/Target/user_diskio_spi.c **** #define CT_SD2		0x04		/* SD ver 2 */
  76:FATFS/Target/user_diskio_spi.c **** #define CT_SDC		(CT_SD1|CT_SD2)	/* SD */
  77:FATFS/Target/user_diskio_spi.c **** #define CT_BLOCK	0x08		/* Block addressing */
  78:FATFS/Target/user_diskio_spi.c **** 
  79:FATFS/Target/user_diskio_spi.c **** static volatile
  80:FATFS/Target/user_diskio_spi.c **** DSTATUS Stat = STA_NOINIT;	/* Physical drive status */
  81:FATFS/Target/user_diskio_spi.c **** 
  82:FATFS/Target/user_diskio_spi.c **** 
  83:FATFS/Target/user_diskio_spi.c **** static
  84:FATFS/Target/user_diskio_spi.c **** BYTE CardType;			/* Card type flags */
  85:FATFS/Target/user_diskio_spi.c **** 
  86:FATFS/Target/user_diskio_spi.c **** uint32_t spiTimerTickStart;
  87:FATFS/Target/user_diskio_spi.c **** uint32_t spiTimerTickDelay;
  88:FATFS/Target/user_diskio_spi.c **** 
  89:FATFS/Target/user_diskio_spi.c **** void SPI_Timer_On(uint32_t waitTicks) {
  65              		.loc 1 89 39
  66              		.cfi_startproc
  67              		@ args = 0, pretend = 0, frame = 8
  68              		@ frame_needed = 1, uses_anonymous_args = 0
  69 0000 80B5     		push	{r7, lr}
  70              		.cfi_def_cfa_offset 8
  71              		.cfi_offset 7, -8
  72              		.cfi_offset 14, -4
  73 0002 82B0     		sub	sp, sp, #8
  74              		.cfi_def_cfa_offset 16
  75 0004 00AF     		add	r7, sp, #0
  76              		.cfi_def_cfa_register 7
  77 0006 7860     		str	r0, [r7, #4]
  90:FATFS/Target/user_diskio_spi.c ****     spiTimerTickStart = HAL_GetTick();
  78              		.loc 1 90 25
  79 0008 FFF7FEFF 		bl	HAL_GetTick
  80 000c 0346     		mov	r3, r0
  81              		.loc 1 90 23
  82 000e 044A     		ldr	r2, .L2
  83 0010 1360     		str	r3, [r2]
  91:FATFS/Target/user_diskio_spi.c ****     spiTimerTickDelay = waitTicks;
  84              		.loc 1 91 23
  85 0012 044A     		ldr	r2, .L2+4
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 4


  86 0014 7B68     		ldr	r3, [r7, #4]
  87 0016 1360     		str	r3, [r2]
  92:FATFS/Target/user_diskio_spi.c **** }
  88              		.loc 1 92 1
  89 0018 00BF     		nop
  90 001a 0837     		adds	r7, r7, #8
  91              		.cfi_def_cfa_offset 8
  92 001c BD46     		mov	sp, r7
  93              		.cfi_def_cfa_register 13
  94              		@ sp needed
  95 001e 80BD     		pop	{r7, pc}
  96              	.L3:
  97              		.align	2
  98              	.L2:
  99 0020 00000000 		.word	spiTimerTickStart
 100 0024 00000000 		.word	spiTimerTickDelay
 101              		.cfi_endproc
 102              	.LFE321:
 104              		.section	.text.SPI_Timer_Status,"ax",%progbits
 105              		.align	1
 106              		.global	SPI_Timer_Status
 107              		.syntax unified
 108              		.thumb
 109              		.thumb_func
 111              	SPI_Timer_Status:
 112              	.LFB322:
  93:FATFS/Target/user_diskio_spi.c **** 
  94:FATFS/Target/user_diskio_spi.c **** uint8_t SPI_Timer_Status() {
 113              		.loc 1 94 28
 114              		.cfi_startproc
 115              		@ args = 0, pretend = 0, frame = 0
 116              		@ frame_needed = 1, uses_anonymous_args = 0
 117 0000 80B5     		push	{r7, lr}
 118              		.cfi_def_cfa_offset 8
 119              		.cfi_offset 7, -8
 120              		.cfi_offset 14, -4
 121 0002 00AF     		add	r7, sp, #0
 122              		.cfi_def_cfa_register 7
  95:FATFS/Target/user_diskio_spi.c ****     return ((HAL_GetTick() - spiTimerTickStart) < spiTimerTickDelay);
 123              		.loc 1 95 14
 124 0004 FFF7FEFF 		bl	HAL_GetTick
 125 0008 0246     		mov	r2, r0
 126              		.loc 1 95 28
 127 000a 064B     		ldr	r3, .L6
 128 000c 1B68     		ldr	r3, [r3]
 129 000e D21A     		subs	r2, r2, r3
 130              		.loc 1 95 49
 131 0010 054B     		ldr	r3, .L6+4
 132 0012 1B68     		ldr	r3, [r3]
 133 0014 9A42     		cmp	r2, r3
 134 0016 34BF     		ite	cc
 135 0018 0123     		movcc	r3, #1
 136 001a 0023     		movcs	r3, #0
 137 001c DBB2     		uxtb	r3, r3
  96:FATFS/Target/user_diskio_spi.c **** }
 138              		.loc 1 96 1
 139 001e 1846     		mov	r0, r3
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 5


 140 0020 80BD     		pop	{r7, pc}
 141              	.L7:
 142 0022 00BF     		.align	2
 143              	.L6:
 144 0024 00000000 		.word	spiTimerTickStart
 145 0028 00000000 		.word	spiTimerTickDelay
 146              		.cfi_endproc
 147              	.LFE322:
 149              		.section	.text.xchg_spi,"ax",%progbits
 150              		.align	1
 151              		.syntax unified
 152              		.thumb
 153              		.thumb_func
 155              	xchg_spi:
 156              	.LFB323:
  97:FATFS/Target/user_diskio_spi.c **** 
  98:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
  99:FATFS/Target/user_diskio_spi.c **** /* SPI controls (Platform dependent)                                     */
 100:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 101:FATFS/Target/user_diskio_spi.c **** 
 102:FATFS/Target/user_diskio_spi.c **** /* Exchange a byte */
 103:FATFS/Target/user_diskio_spi.c **** static
 104:FATFS/Target/user_diskio_spi.c **** BYTE xchg_spi (
 105:FATFS/Target/user_diskio_spi.c **** 	BYTE dat	/* Data to send */
 106:FATFS/Target/user_diskio_spi.c **** )
 107:FATFS/Target/user_diskio_spi.c **** {
 157              		.loc 1 107 1
 158              		.cfi_startproc
 159              		@ args = 0, pretend = 0, frame = 16
 160              		@ frame_needed = 1, uses_anonymous_args = 0
 161 0000 80B5     		push	{r7, lr}
 162              		.cfi_def_cfa_offset 8
 163              		.cfi_offset 7, -8
 164              		.cfi_offset 14, -4
 165 0002 86B0     		sub	sp, sp, #24
 166              		.cfi_def_cfa_offset 32
 167 0004 02AF     		add	r7, sp, #8
 168              		.cfi_def_cfa 7, 24
 169 0006 0346     		mov	r3, r0
 170 0008 FB71     		strb	r3, [r7, #7]
 108:FATFS/Target/user_diskio_spi.c **** 	BYTE rxDat;
 109:FATFS/Target/user_diskio_spi.c ****     HAL_SPI_TransmitReceive(&SD_SPI_HANDLE, &dat, &rxDat, 1, 50);
 171              		.loc 1 109 5
 172 000a 07F10F02 		add	r2, r7, #15
 173 000e F91D     		adds	r1, r7, #7
 174 0010 3223     		movs	r3, #50
 175 0012 0093     		str	r3, [sp]
 176 0014 0123     		movs	r3, #1
 177 0016 0448     		ldr	r0, .L10
 178 0018 FFF7FEFF 		bl	HAL_SPI_TransmitReceive
 110:FATFS/Target/user_diskio_spi.c ****     return rxDat;
 179              		.loc 1 110 12
 180 001c FB7B     		ldrb	r3, [r7, #15]	@ zero_extendqisi2
 111:FATFS/Target/user_diskio_spi.c **** }
 181              		.loc 1 111 1
 182 001e 1846     		mov	r0, r3
 183 0020 1037     		adds	r7, r7, #16
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 6


 184              		.cfi_def_cfa_offset 8
 185 0022 BD46     		mov	sp, r7
 186              		.cfi_def_cfa_register 13
 187              		@ sp needed
 188 0024 80BD     		pop	{r7, pc}
 189              	.L11:
 190 0026 00BF     		.align	2
 191              	.L10:
 192 0028 00000000 		.word	hspi2
 193              		.cfi_endproc
 194              	.LFE323:
 196              		.section	.text.rcvr_spi_multi,"ax",%progbits
 197              		.align	1
 198              		.syntax unified
 199              		.thumb
 200              		.thumb_func
 202              	rcvr_spi_multi:
 203              	.LFB324:
 112:FATFS/Target/user_diskio_spi.c **** 
 113:FATFS/Target/user_diskio_spi.c **** 
 114:FATFS/Target/user_diskio_spi.c **** /* Receive multiple byte */
 115:FATFS/Target/user_diskio_spi.c **** static
 116:FATFS/Target/user_diskio_spi.c **** void rcvr_spi_multi (
 117:FATFS/Target/user_diskio_spi.c **** 	BYTE *buff,		/* Pointer to data buffer */
 118:FATFS/Target/user_diskio_spi.c **** 	UINT btr		/* Number of bytes to receive (even number) */
 119:FATFS/Target/user_diskio_spi.c **** )
 120:FATFS/Target/user_diskio_spi.c **** {
 204              		.loc 1 120 1
 205              		.cfi_startproc
 206              		@ args = 0, pretend = 0, frame = 16
 207              		@ frame_needed = 1, uses_anonymous_args = 0
 208 0000 90B5     		push	{r4, r7, lr}
 209              		.cfi_def_cfa_offset 12
 210              		.cfi_offset 4, -12
 211              		.cfi_offset 7, -8
 212              		.cfi_offset 14, -4
 213 0002 85B0     		sub	sp, sp, #20
 214              		.cfi_def_cfa_offset 32
 215 0004 00AF     		add	r7, sp, #0
 216              		.cfi_def_cfa_register 7
 217 0006 7860     		str	r0, [r7, #4]
 218 0008 3960     		str	r1, [r7]
 219              	.LBB2:
 121:FATFS/Target/user_diskio_spi.c **** 	for(UINT i=0; i<btr; i++) {
 220              		.loc 1 121 11
 221 000a 0023     		movs	r3, #0
 222 000c FB60     		str	r3, [r7, #12]
 223              		.loc 1 121 2
 224 000e 0AE0     		b	.L13
 225              	.L14:
 122:FATFS/Target/user_diskio_spi.c **** 		*(buff+i) = xchg_spi(0xFF);
 226              		.loc 1 122 9 discriminator 3
 227 0010 7A68     		ldr	r2, [r7, #4]
 228 0012 FB68     		ldr	r3, [r7, #12]
 229 0014 D418     		adds	r4, r2, r3
 230              		.loc 1 122 15 discriminator 3
 231 0016 FF20     		movs	r0, #255
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 7


 232 0018 FFF7FEFF 		bl	xchg_spi
 233 001c 0346     		mov	r3, r0
 234              		.loc 1 122 13 discriminator 3
 235 001e 2370     		strb	r3, [r4]
 121:FATFS/Target/user_diskio_spi.c **** 	for(UINT i=0; i<btr; i++) {
 236              		.loc 1 121 24 discriminator 3
 237 0020 FB68     		ldr	r3, [r7, #12]
 238 0022 0133     		adds	r3, r3, #1
 239 0024 FB60     		str	r3, [r7, #12]
 240              	.L13:
 121:FATFS/Target/user_diskio_spi.c **** 	for(UINT i=0; i<btr; i++) {
 241              		.loc 1 121 17 discriminator 1
 242 0026 FA68     		ldr	r2, [r7, #12]
 243 0028 3B68     		ldr	r3, [r7]
 244 002a 9A42     		cmp	r2, r3
 245 002c F0D3     		bcc	.L14
 246              	.LBE2:
 123:FATFS/Target/user_diskio_spi.c **** 	}
 124:FATFS/Target/user_diskio_spi.c **** }
 247              		.loc 1 124 1
 248 002e 00BF     		nop
 249 0030 00BF     		nop
 250 0032 1437     		adds	r7, r7, #20
 251              		.cfi_def_cfa_offset 12
 252 0034 BD46     		mov	sp, r7
 253              		.cfi_def_cfa_register 13
 254              		@ sp needed
 255 0036 90BD     		pop	{r4, r7, pc}
 256              		.cfi_endproc
 257              	.LFE324:
 259              		.section	.text.xmit_spi_multi,"ax",%progbits
 260              		.align	1
 261              		.syntax unified
 262              		.thumb
 263              		.thumb_func
 265              	xmit_spi_multi:
 266              	.LFB325:
 125:FATFS/Target/user_diskio_spi.c **** 
 126:FATFS/Target/user_diskio_spi.c **** 
 127:FATFS/Target/user_diskio_spi.c **** #if _USE_WRITE
 128:FATFS/Target/user_diskio_spi.c **** /* Send multiple byte */
 129:FATFS/Target/user_diskio_spi.c **** static
 130:FATFS/Target/user_diskio_spi.c **** void xmit_spi_multi (
 131:FATFS/Target/user_diskio_spi.c **** 	const BYTE *buff,	/* Pointer to the data */
 132:FATFS/Target/user_diskio_spi.c **** 	UINT btx			/* Number of bytes to send (even number) */
 133:FATFS/Target/user_diskio_spi.c **** )
 134:FATFS/Target/user_diskio_spi.c **** {
 267              		.loc 1 134 1
 268              		.cfi_startproc
 269              		@ args = 0, pretend = 0, frame = 16
 270              		@ frame_needed = 1, uses_anonymous_args = 0
 271 0000 80B5     		push	{r7, lr}
 272              		.cfi_def_cfa_offset 8
 273              		.cfi_offset 7, -8
 274              		.cfi_offset 14, -4
 275 0002 84B0     		sub	sp, sp, #16
 276              		.cfi_def_cfa_offset 24
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 8


 277 0004 00AF     		add	r7, sp, #0
 278              		.cfi_def_cfa_register 7
 279 0006 7860     		str	r0, [r7, #4]
 280 0008 3960     		str	r1, [r7]
 281              	.LBB3:
 135:FATFS/Target/user_diskio_spi.c **** 	for(UINT i=0; i<btx; i++) {
 282              		.loc 1 135 11
 283 000a 0023     		movs	r3, #0
 284 000c FB60     		str	r3, [r7, #12]
 285              		.loc 1 135 2
 286 000e 09E0     		b	.L16
 287              	.L17:
 136:FATFS/Target/user_diskio_spi.c **** 		xchg_spi(*(buff+i));
 288              		.loc 1 136 18 discriminator 3
 289 0010 7A68     		ldr	r2, [r7, #4]
 290 0012 FB68     		ldr	r3, [r7, #12]
 291 0014 1344     		add	r3, r3, r2
 292              		.loc 1 136 3 discriminator 3
 293 0016 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 294 0018 1846     		mov	r0, r3
 295 001a FFF7FEFF 		bl	xchg_spi
 135:FATFS/Target/user_diskio_spi.c **** 	for(UINT i=0; i<btx; i++) {
 296              		.loc 1 135 24 discriminator 3
 297 001e FB68     		ldr	r3, [r7, #12]
 298 0020 0133     		adds	r3, r3, #1
 299 0022 FB60     		str	r3, [r7, #12]
 300              	.L16:
 135:FATFS/Target/user_diskio_spi.c **** 	for(UINT i=0; i<btx; i++) {
 301              		.loc 1 135 17 discriminator 1
 302 0024 FA68     		ldr	r2, [r7, #12]
 303 0026 3B68     		ldr	r3, [r7]
 304 0028 9A42     		cmp	r2, r3
 305 002a F1D3     		bcc	.L17
 306              	.LBE3:
 137:FATFS/Target/user_diskio_spi.c **** 	}
 138:FATFS/Target/user_diskio_spi.c **** }
 307              		.loc 1 138 1
 308 002c 00BF     		nop
 309 002e 00BF     		nop
 310 0030 1037     		adds	r7, r7, #16
 311              		.cfi_def_cfa_offset 8
 312 0032 BD46     		mov	sp, r7
 313              		.cfi_def_cfa_register 13
 314              		@ sp needed
 315 0034 80BD     		pop	{r7, pc}
 316              		.cfi_endproc
 317              	.LFE325:
 319              		.section	.text.wait_ready,"ax",%progbits
 320              		.align	1
 321              		.syntax unified
 322              		.thumb
 323              		.thumb_func
 325              	wait_ready:
 326              	.LFB326:
 139:FATFS/Target/user_diskio_spi.c **** #endif
 140:FATFS/Target/user_diskio_spi.c **** 
 141:FATFS/Target/user_diskio_spi.c **** 
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 9


 142:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 143:FATFS/Target/user_diskio_spi.c **** /* Wait for card ready                                                   */
 144:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 145:FATFS/Target/user_diskio_spi.c **** 
 146:FATFS/Target/user_diskio_spi.c **** static
 147:FATFS/Target/user_diskio_spi.c **** int wait_ready (	/* 1:Ready, 0:Timeout */
 148:FATFS/Target/user_diskio_spi.c **** 	UINT wt			/* Timeout [ms] */
 149:FATFS/Target/user_diskio_spi.c **** )
 150:FATFS/Target/user_diskio_spi.c **** {
 327              		.loc 1 150 1
 328              		.cfi_startproc
 329              		@ args = 0, pretend = 0, frame = 24
 330              		@ frame_needed = 1, uses_anonymous_args = 0
 331 0000 80B5     		push	{r7, lr}
 332              		.cfi_def_cfa_offset 8
 333              		.cfi_offset 7, -8
 334              		.cfi_offset 14, -4
 335 0002 86B0     		sub	sp, sp, #24
 336              		.cfi_def_cfa_offset 32
 337 0004 00AF     		add	r7, sp, #0
 338              		.cfi_def_cfa_register 7
 339 0006 7860     		str	r0, [r7, #4]
 151:FATFS/Target/user_diskio_spi.c **** 	BYTE d;
 152:FATFS/Target/user_diskio_spi.c **** 	//wait_ready needs its own timer, unfortunately, so it can't use the
 153:FATFS/Target/user_diskio_spi.c **** 	//spi_timer functions
 154:FATFS/Target/user_diskio_spi.c **** 	uint32_t waitSpiTimerTickStart;
 155:FATFS/Target/user_diskio_spi.c **** 	uint32_t waitSpiTimerTickDelay;
 156:FATFS/Target/user_diskio_spi.c **** 
 157:FATFS/Target/user_diskio_spi.c **** 	waitSpiTimerTickStart = HAL_GetTick();
 340              		.loc 1 157 26
 341 0008 FFF7FEFF 		bl	HAL_GetTick
 342 000c 7861     		str	r0, [r7, #20]
 158:FATFS/Target/user_diskio_spi.c **** 	waitSpiTimerTickDelay = (uint32_t)wt;
 343              		.loc 1 158 24
 344 000e 7B68     		ldr	r3, [r7, #4]
 345 0010 3B61     		str	r3, [r7, #16]
 346              	.L20:
 159:FATFS/Target/user_diskio_spi.c **** 	do {
 160:FATFS/Target/user_diskio_spi.c **** 		d = xchg_spi(0xFF);
 347              		.loc 1 160 7 discriminator 2
 348 0012 FF20     		movs	r0, #255
 349 0014 FFF7FEFF 		bl	xchg_spi
 350 0018 0346     		mov	r3, r0
 351 001a FB73     		strb	r3, [r7, #15]
 161:FATFS/Target/user_diskio_spi.c **** 		/* This loop takes a time. Insert rot_rdq() here for multitask envilonment. */
 162:FATFS/Target/user_diskio_spi.c **** 	} while (d != 0xFF && ((HAL_GetTick() - waitSpiTimerTickStart) < waitSpiTimerTickDelay));	/* Wait 
 352              		.loc 1 162 21 discriminator 2
 353 001c FB7B     		ldrb	r3, [r7, #15]	@ zero_extendqisi2
 354 001e FF2B     		cmp	r3, #255
 355 0020 07D0     		beq	.L19
 356              		.loc 1 162 26 discriminator 1
 357 0022 FFF7FEFF 		bl	HAL_GetTick
 358 0026 0246     		mov	r2, r0
 359              		.loc 1 162 40 discriminator 1
 360 0028 7B69     		ldr	r3, [r7, #20]
 361 002a D31A     		subs	r3, r2, r3
 362              		.loc 1 162 21 discriminator 1
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 10


 363 002c 3A69     		ldr	r2, [r7, #16]
 364 002e 9A42     		cmp	r2, r3
 365 0030 EFD8     		bhi	.L20
 366              	.L19:
 163:FATFS/Target/user_diskio_spi.c **** 
 164:FATFS/Target/user_diskio_spi.c **** 	return (d == 0xFF) ? 1 : 0;
 367              		.loc 1 164 25
 368 0032 FB7B     		ldrb	r3, [r7, #15]	@ zero_extendqisi2
 369 0034 FF2B     		cmp	r3, #255
 370 0036 0CBF     		ite	eq
 371 0038 0123     		moveq	r3, #1
 372 003a 0023     		movne	r3, #0
 373 003c DBB2     		uxtb	r3, r3
 165:FATFS/Target/user_diskio_spi.c **** }
 374              		.loc 1 165 1
 375 003e 1846     		mov	r0, r3
 376 0040 1837     		adds	r7, r7, #24
 377              		.cfi_def_cfa_offset 8
 378 0042 BD46     		mov	sp, r7
 379              		.cfi_def_cfa_register 13
 380              		@ sp needed
 381 0044 80BD     		pop	{r7, pc}
 382              		.cfi_endproc
 383              	.LFE326:
 385              		.section	.text.despiselect,"ax",%progbits
 386              		.align	1
 387              		.syntax unified
 388              		.thumb
 389              		.thumb_func
 391              	despiselect:
 392              	.LFB327:
 166:FATFS/Target/user_diskio_spi.c **** 
 167:FATFS/Target/user_diskio_spi.c **** 
 168:FATFS/Target/user_diskio_spi.c **** 
 169:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 170:FATFS/Target/user_diskio_spi.c **** /* Despiselect card and release SPI                                         */
 171:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 172:FATFS/Target/user_diskio_spi.c **** 
 173:FATFS/Target/user_diskio_spi.c **** static
 174:FATFS/Target/user_diskio_spi.c **** void despiselect (void)
 175:FATFS/Target/user_diskio_spi.c **** {
 393              		.loc 1 175 1
 394              		.cfi_startproc
 395              		@ args = 0, pretend = 0, frame = 0
 396              		@ frame_needed = 1, uses_anonymous_args = 0
 397 0000 80B5     		push	{r7, lr}
 398              		.cfi_def_cfa_offset 8
 399              		.cfi_offset 7, -8
 400              		.cfi_offset 14, -4
 401 0002 00AF     		add	r7, sp, #0
 402              		.cfi_def_cfa_register 7
 176:FATFS/Target/user_diskio_spi.c **** 	CS_HIGH();		/* Set CS# high */
 403              		.loc 1 176 2
 404 0004 0122     		movs	r2, #1
 405 0006 4FF48061 		mov	r1, #1024
 406 000a 0448     		ldr	r0, .L23
 407 000c FFF7FEFF 		bl	HAL_GPIO_WritePin
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 11


 177:FATFS/Target/user_diskio_spi.c **** 	xchg_spi(0xFF);	/* Dummy clock (force DO hi-z for multiple slave SPI) */
 408              		.loc 1 177 2
 409 0010 FF20     		movs	r0, #255
 410 0012 FFF7FEFF 		bl	xchg_spi
 178:FATFS/Target/user_diskio_spi.c **** 
 179:FATFS/Target/user_diskio_spi.c **** }
 411              		.loc 1 179 1
 412 0016 00BF     		nop
 413 0018 80BD     		pop	{r7, pc}
 414              	.L24:
 415 001a 00BF     		.align	2
 416              	.L23:
 417 001c 00180048 		.word	1207965696
 418              		.cfi_endproc
 419              	.LFE327:
 421              		.section	.text.spiselect,"ax",%progbits
 422              		.align	1
 423              		.syntax unified
 424              		.thumb
 425              		.thumb_func
 427              	spiselect:
 428              	.LFB328:
 180:FATFS/Target/user_diskio_spi.c **** 
 181:FATFS/Target/user_diskio_spi.c **** 
 182:FATFS/Target/user_diskio_spi.c **** 
 183:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 184:FATFS/Target/user_diskio_spi.c **** /* Select card and wait for ready                                        */
 185:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 186:FATFS/Target/user_diskio_spi.c **** 
 187:FATFS/Target/user_diskio_spi.c **** static
 188:FATFS/Target/user_diskio_spi.c **** int spiselect (void)	/* 1:OK, 0:Timeout */
 189:FATFS/Target/user_diskio_spi.c **** {
 429              		.loc 1 189 1
 430              		.cfi_startproc
 431              		@ args = 0, pretend = 0, frame = 0
 432              		@ frame_needed = 1, uses_anonymous_args = 0
 433 0000 80B5     		push	{r7, lr}
 434              		.cfi_def_cfa_offset 8
 435              		.cfi_offset 7, -8
 436              		.cfi_offset 14, -4
 437 0002 00AF     		add	r7, sp, #0
 438              		.cfi_def_cfa_register 7
 190:FATFS/Target/user_diskio_spi.c **** 	CS_LOW();		/* Set CS# low */
 439              		.loc 1 190 2
 440 0004 0022     		movs	r2, #0
 441 0006 4FF48061 		mov	r1, #1024
 442 000a 0A48     		ldr	r0, .L28
 443 000c FFF7FEFF 		bl	HAL_GPIO_WritePin
 191:FATFS/Target/user_diskio_spi.c **** 	xchg_spi(0xFF);	/* Dummy clock (force DO enabled) */
 444              		.loc 1 191 2
 445 0010 FF20     		movs	r0, #255
 446 0012 FFF7FEFF 		bl	xchg_spi
 192:FATFS/Target/user_diskio_spi.c **** 	if (wait_ready(500)) return 1;	/* Wait for card ready */
 447              		.loc 1 192 6
 448 0016 4FF4FA70 		mov	r0, #500
 449 001a FFF7FEFF 		bl	wait_ready
 450 001e 0346     		mov	r3, r0
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 12


 451              		.loc 1 192 5
 452 0020 002B     		cmp	r3, #0
 453 0022 01D0     		beq	.L26
 454              		.loc 1 192 30 discriminator 1
 455 0024 0123     		movs	r3, #1
 456 0026 02E0     		b	.L27
 457              	.L26:
 193:FATFS/Target/user_diskio_spi.c **** 
 194:FATFS/Target/user_diskio_spi.c **** 	despiselect();
 458              		.loc 1 194 2
 459 0028 FFF7FEFF 		bl	despiselect
 195:FATFS/Target/user_diskio_spi.c **** 	return 0;	/* Timeout */
 460              		.loc 1 195 9
 461 002c 0023     		movs	r3, #0
 462              	.L27:
 196:FATFS/Target/user_diskio_spi.c **** }
 463              		.loc 1 196 1
 464 002e 1846     		mov	r0, r3
 465 0030 80BD     		pop	{r7, pc}
 466              	.L29:
 467 0032 00BF     		.align	2
 468              	.L28:
 469 0034 00180048 		.word	1207965696
 470              		.cfi_endproc
 471              	.LFE328:
 473              		.section	.text.rcvr_datablock,"ax",%progbits
 474              		.align	1
 475              		.syntax unified
 476              		.thumb
 477              		.thumb_func
 479              	rcvr_datablock:
 480              	.LFB329:
 197:FATFS/Target/user_diskio_spi.c **** 
 198:FATFS/Target/user_diskio_spi.c **** 
 199:FATFS/Target/user_diskio_spi.c **** 
 200:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 201:FATFS/Target/user_diskio_spi.c **** /* Receive a data packet from the MMC                                    */
 202:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 203:FATFS/Target/user_diskio_spi.c **** 
 204:FATFS/Target/user_diskio_spi.c **** static
 205:FATFS/Target/user_diskio_spi.c **** int rcvr_datablock (	/* 1:OK, 0:Error */
 206:FATFS/Target/user_diskio_spi.c **** 	BYTE *buff,			/* Data buffer */
 207:FATFS/Target/user_diskio_spi.c **** 	UINT btr			/* Data block length (byte) */
 208:FATFS/Target/user_diskio_spi.c **** )
 209:FATFS/Target/user_diskio_spi.c **** {
 481              		.loc 1 209 1
 482              		.cfi_startproc
 483              		@ args = 0, pretend = 0, frame = 16
 484              		@ frame_needed = 1, uses_anonymous_args = 0
 485 0000 80B5     		push	{r7, lr}
 486              		.cfi_def_cfa_offset 8
 487              		.cfi_offset 7, -8
 488              		.cfi_offset 14, -4
 489 0002 84B0     		sub	sp, sp, #16
 490              		.cfi_def_cfa_offset 24
 491 0004 00AF     		add	r7, sp, #0
 492              		.cfi_def_cfa_register 7
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 13


 493 0006 7860     		str	r0, [r7, #4]
 494 0008 3960     		str	r1, [r7]
 210:FATFS/Target/user_diskio_spi.c **** 	BYTE token;
 211:FATFS/Target/user_diskio_spi.c **** 
 212:FATFS/Target/user_diskio_spi.c **** 
 213:FATFS/Target/user_diskio_spi.c **** 	SPI_Timer_On(200);
 495              		.loc 1 213 2
 496 000a C820     		movs	r0, #200
 497 000c FFF7FEFF 		bl	SPI_Timer_On
 498              	.L32:
 214:FATFS/Target/user_diskio_spi.c **** 	do {							/* Wait for DataStart token in timeout of 200ms */
 215:FATFS/Target/user_diskio_spi.c **** 		token = xchg_spi(0xFF);
 499              		.loc 1 215 11 discriminator 2
 500 0010 FF20     		movs	r0, #255
 501 0012 FFF7FEFF 		bl	xchg_spi
 502 0016 0346     		mov	r3, r0
 503 0018 FB73     		strb	r3, [r7, #15]
 216:FATFS/Target/user_diskio_spi.c **** 		/* This loop will take a time. Insert rot_rdq() here for multitask envilonment. */
 217:FATFS/Target/user_diskio_spi.c **** 	} while ((token == 0xFF) && SPI_Timer_Status());
 504              		.loc 1 217 27 discriminator 2
 505 001a FB7B     		ldrb	r3, [r7, #15]	@ zero_extendqisi2
 506 001c FF2B     		cmp	r3, #255
 507 001e 04D1     		bne	.L31
 508              		.loc 1 217 30 discriminator 1
 509 0020 FFF7FEFF 		bl	SPI_Timer_Status
 510 0024 0346     		mov	r3, r0
 511              		.loc 1 217 27 discriminator 1
 512 0026 002B     		cmp	r3, #0
 513 0028 F2D1     		bne	.L32
 514              	.L31:
 218:FATFS/Target/user_diskio_spi.c **** 	if(token != 0xFE) return 0;		/* Function fails if invalid DataStart token or timeout */
 515              		.loc 1 218 4
 516 002a FB7B     		ldrb	r3, [r7, #15]	@ zero_extendqisi2
 517 002c FE2B     		cmp	r3, #254
 518 002e 01D0     		beq	.L33
 519              		.loc 1 218 27 discriminator 1
 520 0030 0023     		movs	r3, #0
 521 0032 0AE0     		b	.L34
 522              	.L33:
 219:FATFS/Target/user_diskio_spi.c **** 
 220:FATFS/Target/user_diskio_spi.c **** 	rcvr_spi_multi(buff, btr);		/* Store trailing data to the buffer */
 523              		.loc 1 220 2
 524 0034 3968     		ldr	r1, [r7]
 525 0036 7868     		ldr	r0, [r7, #4]
 526 0038 FFF7FEFF 		bl	rcvr_spi_multi
 221:FATFS/Target/user_diskio_spi.c **** 	xchg_spi(0xFF); xchg_spi(0xFF);			/* Discard CRC */
 527              		.loc 1 221 2
 528 003c FF20     		movs	r0, #255
 529 003e FFF7FEFF 		bl	xchg_spi
 530              		.loc 1 221 18
 531 0042 FF20     		movs	r0, #255
 532 0044 FFF7FEFF 		bl	xchg_spi
 222:FATFS/Target/user_diskio_spi.c **** 
 223:FATFS/Target/user_diskio_spi.c **** 	return 1;						/* Function succeeded */
 533              		.loc 1 223 9
 534 0048 0123     		movs	r3, #1
 535              	.L34:
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 14


 224:FATFS/Target/user_diskio_spi.c **** }
 536              		.loc 1 224 1
 537 004a 1846     		mov	r0, r3
 538 004c 1037     		adds	r7, r7, #16
 539              		.cfi_def_cfa_offset 8
 540 004e BD46     		mov	sp, r7
 541              		.cfi_def_cfa_register 13
 542              		@ sp needed
 543 0050 80BD     		pop	{r7, pc}
 544              		.cfi_endproc
 545              	.LFE329:
 547              		.section	.text.xmit_datablock,"ax",%progbits
 548              		.align	1
 549              		.syntax unified
 550              		.thumb
 551              		.thumb_func
 553              	xmit_datablock:
 554              	.LFB330:
 225:FATFS/Target/user_diskio_spi.c **** 
 226:FATFS/Target/user_diskio_spi.c **** 
 227:FATFS/Target/user_diskio_spi.c **** 
 228:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 229:FATFS/Target/user_diskio_spi.c **** /* Send a data packet to the MMC                                         */
 230:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 231:FATFS/Target/user_diskio_spi.c **** 
 232:FATFS/Target/user_diskio_spi.c **** #if _USE_WRITE
 233:FATFS/Target/user_diskio_spi.c **** static
 234:FATFS/Target/user_diskio_spi.c **** int xmit_datablock (	/* 1:OK, 0:Failed */
 235:FATFS/Target/user_diskio_spi.c **** 	const BYTE *buff,	/* Ponter to 512 byte data to be sent */
 236:FATFS/Target/user_diskio_spi.c **** 	BYTE token			/* Token */
 237:FATFS/Target/user_diskio_spi.c **** )
 238:FATFS/Target/user_diskio_spi.c **** {
 555              		.loc 1 238 1
 556              		.cfi_startproc
 557              		@ args = 0, pretend = 0, frame = 16
 558              		@ frame_needed = 1, uses_anonymous_args = 0
 559 0000 80B5     		push	{r7, lr}
 560              		.cfi_def_cfa_offset 8
 561              		.cfi_offset 7, -8
 562              		.cfi_offset 14, -4
 563 0002 84B0     		sub	sp, sp, #16
 564              		.cfi_def_cfa_offset 24
 565 0004 00AF     		add	r7, sp, #0
 566              		.cfi_def_cfa_register 7
 567 0006 7860     		str	r0, [r7, #4]
 568 0008 0B46     		mov	r3, r1
 569 000a FB70     		strb	r3, [r7, #3]
 239:FATFS/Target/user_diskio_spi.c **** 	BYTE resp;
 240:FATFS/Target/user_diskio_spi.c **** 
 241:FATFS/Target/user_diskio_spi.c **** 
 242:FATFS/Target/user_diskio_spi.c **** 	if (!wait_ready(500)) return 0;		/* Wait for card ready */
 570              		.loc 1 242 7
 571 000c 4FF4FA70 		mov	r0, #500
 572 0010 FFF7FEFF 		bl	wait_ready
 573 0014 0346     		mov	r3, r0
 574              		.loc 1 242 5
 575 0016 002B     		cmp	r3, #0
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 15


 576 0018 01D1     		bne	.L36
 577              		.loc 1 242 31 discriminator 1
 578 001a 0023     		movs	r3, #0
 579 001c 1EE0     		b	.L37
 580              	.L36:
 243:FATFS/Target/user_diskio_spi.c **** 
 244:FATFS/Target/user_diskio_spi.c **** 	xchg_spi(token);					/* Send token */
 581              		.loc 1 244 2
 582 001e FB78     		ldrb	r3, [r7, #3]	@ zero_extendqisi2
 583 0020 1846     		mov	r0, r3
 584 0022 FFF7FEFF 		bl	xchg_spi
 245:FATFS/Target/user_diskio_spi.c **** 	if (token != 0xFD) {				/* Send data if token is other than StopTran */
 585              		.loc 1 245 5
 586 0026 FB78     		ldrb	r3, [r7, #3]	@ zero_extendqisi2
 587 0028 FD2B     		cmp	r3, #253
 588 002a 16D0     		beq	.L38
 246:FATFS/Target/user_diskio_spi.c **** 		xmit_spi_multi(buff, 512);		/* Data */
 589              		.loc 1 246 3
 590 002c 4FF40071 		mov	r1, #512
 591 0030 7868     		ldr	r0, [r7, #4]
 592 0032 FFF7FEFF 		bl	xmit_spi_multi
 247:FATFS/Target/user_diskio_spi.c **** 		xchg_spi(0xFF); xchg_spi(0xFF);	/* Dummy CRC */
 593              		.loc 1 247 3
 594 0036 FF20     		movs	r0, #255
 595 0038 FFF7FEFF 		bl	xchg_spi
 596              		.loc 1 247 19
 597 003c FF20     		movs	r0, #255
 598 003e FFF7FEFF 		bl	xchg_spi
 248:FATFS/Target/user_diskio_spi.c **** 
 249:FATFS/Target/user_diskio_spi.c **** 		resp = xchg_spi(0xFF);				/* Receive data resp */
 599              		.loc 1 249 10
 600 0042 FF20     		movs	r0, #255
 601 0044 FFF7FEFF 		bl	xchg_spi
 602 0048 0346     		mov	r3, r0
 603 004a FB73     		strb	r3, [r7, #15]
 250:FATFS/Target/user_diskio_spi.c **** 		if ((resp & 0x1F) != 0x05) return 0;	/* Function fails if the data packet was not accepted */
 604              		.loc 1 250 13
 605 004c FB7B     		ldrb	r3, [r7, #15]	@ zero_extendqisi2
 606 004e 03F01F03 		and	r3, r3, #31
 607              		.loc 1 250 6
 608 0052 052B     		cmp	r3, #5
 609 0054 01D0     		beq	.L38
 610              		.loc 1 250 37 discriminator 1
 611 0056 0023     		movs	r3, #0
 612 0058 00E0     		b	.L37
 613              	.L38:
 251:FATFS/Target/user_diskio_spi.c **** 	}
 252:FATFS/Target/user_diskio_spi.c **** 	return 1;
 614              		.loc 1 252 9
 615 005a 0123     		movs	r3, #1
 616              	.L37:
 253:FATFS/Target/user_diskio_spi.c **** }
 617              		.loc 1 253 1
 618 005c 1846     		mov	r0, r3
 619 005e 1037     		adds	r7, r7, #16
 620              		.cfi_def_cfa_offset 8
 621 0060 BD46     		mov	sp, r7
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 16


 622              		.cfi_def_cfa_register 13
 623              		@ sp needed
 624 0062 80BD     		pop	{r7, pc}
 625              		.cfi_endproc
 626              	.LFE330:
 628              		.section	.text.send_cmd,"ax",%progbits
 629              		.align	1
 630              		.syntax unified
 631              		.thumb
 632              		.thumb_func
 634              	send_cmd:
 635              	.LFB331:
 254:FATFS/Target/user_diskio_spi.c **** #endif
 255:FATFS/Target/user_diskio_spi.c **** 
 256:FATFS/Target/user_diskio_spi.c **** 
 257:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 258:FATFS/Target/user_diskio_spi.c **** /* Send a command packet to the MMC                                      */
 259:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 260:FATFS/Target/user_diskio_spi.c **** 
 261:FATFS/Target/user_diskio_spi.c **** static
 262:FATFS/Target/user_diskio_spi.c **** BYTE send_cmd (		/* Return value: R1 resp (bit7==1:Failed to send) */
 263:FATFS/Target/user_diskio_spi.c **** 	BYTE cmd,		/* Command index */
 264:FATFS/Target/user_diskio_spi.c **** 	DWORD arg		/* Argument */
 265:FATFS/Target/user_diskio_spi.c **** )
 266:FATFS/Target/user_diskio_spi.c **** {
 636              		.loc 1 266 1
 637              		.cfi_startproc
 638              		@ args = 0, pretend = 0, frame = 16
 639              		@ frame_needed = 1, uses_anonymous_args = 0
 640 0000 80B5     		push	{r7, lr}
 641              		.cfi_def_cfa_offset 8
 642              		.cfi_offset 7, -8
 643              		.cfi_offset 14, -4
 644 0002 84B0     		sub	sp, sp, #16
 645              		.cfi_def_cfa_offset 24
 646 0004 00AF     		add	r7, sp, #0
 647              		.cfi_def_cfa_register 7
 648 0006 0346     		mov	r3, r0
 649 0008 3960     		str	r1, [r7]
 650 000a FB71     		strb	r3, [r7, #7]
 267:FATFS/Target/user_diskio_spi.c **** 	BYTE n, res;
 268:FATFS/Target/user_diskio_spi.c **** 
 269:FATFS/Target/user_diskio_spi.c **** 
 270:FATFS/Target/user_diskio_spi.c **** 	if (cmd & 0x80) {	/* Send a CMD55 prior to ACMD<n> */
 651              		.loc 1 270 6
 652 000c 97F90730 		ldrsb	r3, [r7, #7]
 653              		.loc 1 270 5
 654 0010 002B     		cmp	r3, #0
 655 0012 0EDA     		bge	.L40
 271:FATFS/Target/user_diskio_spi.c **** 		cmd &= 0x7F;
 656              		.loc 1 271 7
 657 0014 FB79     		ldrb	r3, [r7, #7]
 658 0016 03F07F03 		and	r3, r3, #127
 659 001a FB71     		strb	r3, [r7, #7]
 272:FATFS/Target/user_diskio_spi.c **** 		res = send_cmd(CMD55, 0);
 660              		.loc 1 272 9
 661 001c 0021     		movs	r1, #0
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 17


 662 001e 3720     		movs	r0, #55
 663 0020 FFF7EEFF 		bl	send_cmd
 664 0024 0346     		mov	r3, r0
 665 0026 BB73     		strb	r3, [r7, #14]
 273:FATFS/Target/user_diskio_spi.c **** 		if (res > 1) return res;
 666              		.loc 1 273 6
 667 0028 BB7B     		ldrb	r3, [r7, #14]	@ zero_extendqisi2
 668 002a 012B     		cmp	r3, #1
 669 002c 01D9     		bls	.L40
 670              		.loc 1 273 23 discriminator 1
 671 002e BB7B     		ldrb	r3, [r7, #14]	@ zero_extendqisi2
 672 0030 51E0     		b	.L41
 673              	.L40:
 274:FATFS/Target/user_diskio_spi.c **** 	}
 275:FATFS/Target/user_diskio_spi.c **** 
 276:FATFS/Target/user_diskio_spi.c **** 	/* Select the card and wait for ready except to stop multiple block read */
 277:FATFS/Target/user_diskio_spi.c **** 	if (cmd != CMD12) {
 674              		.loc 1 277 5
 675 0032 FB79     		ldrb	r3, [r7, #7]	@ zero_extendqisi2
 676 0034 0C2B     		cmp	r3, #12
 677 0036 08D0     		beq	.L42
 278:FATFS/Target/user_diskio_spi.c **** 		despiselect();
 678              		.loc 1 278 3
 679 0038 FFF7FEFF 		bl	despiselect
 279:FATFS/Target/user_diskio_spi.c **** 		if (!spiselect()) return 0xFF;
 680              		.loc 1 279 8
 681 003c FFF7FEFF 		bl	spiselect
 682 0040 0346     		mov	r3, r0
 683              		.loc 1 279 6
 684 0042 002B     		cmp	r3, #0
 685 0044 01D1     		bne	.L42
 686              		.loc 1 279 28 discriminator 1
 687 0046 FF23     		movs	r3, #255
 688 0048 45E0     		b	.L41
 689              	.L42:
 280:FATFS/Target/user_diskio_spi.c **** 	}
 281:FATFS/Target/user_diskio_spi.c **** 
 282:FATFS/Target/user_diskio_spi.c **** 	/* Send command packet */
 283:FATFS/Target/user_diskio_spi.c **** 	xchg_spi(0x40 | cmd);				/* Start + command index */
 690              		.loc 1 283 2
 691 004a FB79     		ldrb	r3, [r7, #7]
 692 004c 43F04003 		orr	r3, r3, #64
 693 0050 DBB2     		uxtb	r3, r3
 694 0052 1846     		mov	r0, r3
 695 0054 FFF7FEFF 		bl	xchg_spi
 284:FATFS/Target/user_diskio_spi.c **** 	xchg_spi((BYTE)(arg >> 24));		/* Argument[31..24] */
 696              		.loc 1 284 22
 697 0058 3B68     		ldr	r3, [r7]
 698 005a 1B0E     		lsrs	r3, r3, #24
 699              		.loc 1 284 2
 700 005c DBB2     		uxtb	r3, r3
 701 005e 1846     		mov	r0, r3
 702 0060 FFF7FEFF 		bl	xchg_spi
 285:FATFS/Target/user_diskio_spi.c **** 	xchg_spi((BYTE)(arg >> 16));		/* Argument[23..16] */
 703              		.loc 1 285 22
 704 0064 3B68     		ldr	r3, [r7]
 705 0066 1B0C     		lsrs	r3, r3, #16
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 18


 706              		.loc 1 285 2
 707 0068 DBB2     		uxtb	r3, r3
 708 006a 1846     		mov	r0, r3
 709 006c FFF7FEFF 		bl	xchg_spi
 286:FATFS/Target/user_diskio_spi.c **** 	xchg_spi((BYTE)(arg >> 8));			/* Argument[15..8] */
 710              		.loc 1 286 22
 711 0070 3B68     		ldr	r3, [r7]
 712 0072 1B0A     		lsrs	r3, r3, #8
 713              		.loc 1 286 2
 714 0074 DBB2     		uxtb	r3, r3
 715 0076 1846     		mov	r0, r3
 716 0078 FFF7FEFF 		bl	xchg_spi
 287:FATFS/Target/user_diskio_spi.c **** 	xchg_spi((BYTE)arg);				/* Argument[7..0] */
 717              		.loc 1 287 2
 718 007c 3B68     		ldr	r3, [r7]
 719 007e DBB2     		uxtb	r3, r3
 720 0080 1846     		mov	r0, r3
 721 0082 FFF7FEFF 		bl	xchg_spi
 288:FATFS/Target/user_diskio_spi.c **** 	n = 0x01;							/* Dummy CRC + Stop */
 722              		.loc 1 288 4
 723 0086 0123     		movs	r3, #1
 724 0088 FB73     		strb	r3, [r7, #15]
 289:FATFS/Target/user_diskio_spi.c **** 	if (cmd == CMD0) n = 0x95;			/* Valid CRC for CMD0(0) */
 725              		.loc 1 289 5
 726 008a FB79     		ldrb	r3, [r7, #7]	@ zero_extendqisi2
 727 008c 002B     		cmp	r3, #0
 728 008e 01D1     		bne	.L43
 729              		.loc 1 289 21 discriminator 1
 730 0090 9523     		movs	r3, #149
 731 0092 FB73     		strb	r3, [r7, #15]
 732              	.L43:
 290:FATFS/Target/user_diskio_spi.c **** 	if (cmd == CMD8) n = 0x87;			/* Valid CRC for CMD8(0x1AA) */
 733              		.loc 1 290 5
 734 0094 FB79     		ldrb	r3, [r7, #7]	@ zero_extendqisi2
 735 0096 082B     		cmp	r3, #8
 736 0098 01D1     		bne	.L44
 737              		.loc 1 290 21 discriminator 1
 738 009a 8723     		movs	r3, #135
 739 009c FB73     		strb	r3, [r7, #15]
 740              	.L44:
 291:FATFS/Target/user_diskio_spi.c **** 	xchg_spi(n);
 741              		.loc 1 291 2
 742 009e FB7B     		ldrb	r3, [r7, #15]	@ zero_extendqisi2
 743 00a0 1846     		mov	r0, r3
 744 00a2 FFF7FEFF 		bl	xchg_spi
 292:FATFS/Target/user_diskio_spi.c **** 
 293:FATFS/Target/user_diskio_spi.c **** 	/* Receive command resp */
 294:FATFS/Target/user_diskio_spi.c **** 	if (cmd == CMD12) xchg_spi(0xFF);	/* Diacard following one byte when CMD12 */
 745              		.loc 1 294 5
 746 00a6 FB79     		ldrb	r3, [r7, #7]	@ zero_extendqisi2
 747 00a8 0C2B     		cmp	r3, #12
 748 00aa 02D1     		bne	.L45
 749              		.loc 1 294 20 discriminator 1
 750 00ac FF20     		movs	r0, #255
 751 00ae FFF7FEFF 		bl	xchg_spi
 752              	.L45:
 295:FATFS/Target/user_diskio_spi.c **** 	n = 10;								/* Wait for response (10 bytes max) */
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 19


 753              		.loc 1 295 4
 754 00b2 0A23     		movs	r3, #10
 755 00b4 FB73     		strb	r3, [r7, #15]
 756              	.L47:
 296:FATFS/Target/user_diskio_spi.c **** 	do {
 297:FATFS/Target/user_diskio_spi.c **** 		res = xchg_spi(0xFF);
 757              		.loc 1 297 9 discriminator 2
 758 00b6 FF20     		movs	r0, #255
 759 00b8 FFF7FEFF 		bl	xchg_spi
 760 00bc 0346     		mov	r3, r0
 761 00be BB73     		strb	r3, [r7, #14]
 298:FATFS/Target/user_diskio_spi.c **** 	} while ((res & 0x80) && --n);
 762              		.loc 1 298 11 discriminator 2
 763 00c0 97F90E30 		ldrsb	r3, [r7, #14]
 764              		.loc 1 298 24 discriminator 2
 765 00c4 002B     		cmp	r3, #0
 766 00c6 05DA     		bge	.L46
 767              		.loc 1 298 24 is_stmt 0 discriminator 1
 768 00c8 FB7B     		ldrb	r3, [r7, #15]
 769 00ca 013B     		subs	r3, r3, #1
 770 00cc FB73     		strb	r3, [r7, #15]
 771 00ce FB7B     		ldrb	r3, [r7, #15]	@ zero_extendqisi2
 772 00d0 002B     		cmp	r3, #0
 773 00d2 F0D1     		bne	.L47
 774              	.L46:
 299:FATFS/Target/user_diskio_spi.c **** 
 300:FATFS/Target/user_diskio_spi.c **** 	return res;							/* Return received response */
 775              		.loc 1 300 9 is_stmt 1
 776 00d4 BB7B     		ldrb	r3, [r7, #14]	@ zero_extendqisi2
 777              	.L41:
 301:FATFS/Target/user_diskio_spi.c **** }
 778              		.loc 1 301 1
 779 00d6 1846     		mov	r0, r3
 780 00d8 1037     		adds	r7, r7, #16
 781              		.cfi_def_cfa_offset 8
 782 00da BD46     		mov	sp, r7
 783              		.cfi_def_cfa_register 13
 784              		@ sp needed
 785 00dc 80BD     		pop	{r7, pc}
 786              		.cfi_endproc
 787              	.LFE331:
 789              		.section	.text.USER_SPI_initialize,"ax",%progbits
 790              		.align	1
 791              		.global	USER_SPI_initialize
 792              		.syntax unified
 793              		.thumb
 794              		.thumb_func
 796              	USER_SPI_initialize:
 797              	.LFB332:
 302:FATFS/Target/user_diskio_spi.c **** 
 303:FATFS/Target/user_diskio_spi.c **** 
 304:FATFS/Target/user_diskio_spi.c **** /*--------------------------------------------------------------------------
 305:FATFS/Target/user_diskio_spi.c **** 
 306:FATFS/Target/user_diskio_spi.c ****    Public FatFs Functions (wrapped in user_diskio.c)
 307:FATFS/Target/user_diskio_spi.c **** 
 308:FATFS/Target/user_diskio_spi.c **** ---------------------------------------------------------------------------*/
 309:FATFS/Target/user_diskio_spi.c **** 
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 20


 310:FATFS/Target/user_diskio_spi.c **** //The following functions are defined as inline because they aren't the functions that
 311:FATFS/Target/user_diskio_spi.c **** //are passed to FatFs - they are wrapped by autogenerated (non-inline) cubemx template
 312:FATFS/Target/user_diskio_spi.c **** //code.
 313:FATFS/Target/user_diskio_spi.c **** //If you do not wish to use cubemx, remove the "inline" from these functions here
 314:FATFS/Target/user_diskio_spi.c **** //and in the associated .h
 315:FATFS/Target/user_diskio_spi.c **** 
 316:FATFS/Target/user_diskio_spi.c **** 
 317:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 318:FATFS/Target/user_diskio_spi.c **** /* Initialize disk drive                                                 */
 319:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 320:FATFS/Target/user_diskio_spi.c **** 
 321:FATFS/Target/user_diskio_spi.c **** inline DSTATUS USER_SPI_initialize (
 322:FATFS/Target/user_diskio_spi.c **** 	BYTE drv		/* Physical drive number (0) */
 323:FATFS/Target/user_diskio_spi.c **** )
 324:FATFS/Target/user_diskio_spi.c **** {
 798              		.loc 1 324 1
 799              		.cfi_startproc
 800              		@ args = 0, pretend = 0, frame = 16
 801              		@ frame_needed = 1, uses_anonymous_args = 0
 802 0000 90B5     		push	{r4, r7, lr}
 803              		.cfi_def_cfa_offset 12
 804              		.cfi_offset 4, -12
 805              		.cfi_offset 7, -8
 806              		.cfi_offset 14, -4
 807 0002 85B0     		sub	sp, sp, #20
 808              		.cfi_def_cfa_offset 32
 809 0004 00AF     		add	r7, sp, #0
 810              		.cfi_def_cfa_register 7
 811 0006 0346     		mov	r3, r0
 812 0008 FB71     		strb	r3, [r7, #7]
 325:FATFS/Target/user_diskio_spi.c **** 	BYTE n, cmd, ty, ocr[4];
 326:FATFS/Target/user_diskio_spi.c **** 
 327:FATFS/Target/user_diskio_spi.c **** 	if (drv != 0) return STA_NOINIT;		/* Supports only drive 0 */
 813              		.loc 1 327 5
 814 000a FB79     		ldrb	r3, [r7, #7]	@ zero_extendqisi2
 815 000c 002B     		cmp	r3, #0
 816 000e 01D0     		beq	.L49
 817              		.loc 1 327 23 discriminator 1
 818 0010 0123     		movs	r3, #1
 819 0012 D6E0     		b	.L71
 820              	.L49:
 328:FATFS/Target/user_diskio_spi.c **** 	//assume SPI already init init_spi();	/* Initialize SPI */
 329:FATFS/Target/user_diskio_spi.c **** 
 330:FATFS/Target/user_diskio_spi.c **** 	if (Stat & STA_NODISK) return Stat;	/* Is card existing in the soket? */
 821              		.loc 1 330 11
 822 0014 6D4B     		ldr	r3, .L73
 823 0016 1B78     		ldrb	r3, [r3]
 824 0018 DBB2     		uxtb	r3, r3
 825 001a 03F00203 		and	r3, r3, #2
 826              		.loc 1 330 5
 827 001e 002B     		cmp	r3, #0
 828 0020 03D0     		beq	.L51
 829              		.loc 1 330 32 discriminator 1
 830 0022 6A4B     		ldr	r3, .L73
 831 0024 1B78     		ldrb	r3, [r3]
 832 0026 DBB2     		uxtb	r3, r3
 833 0028 CBE0     		b	.L71
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 21


 834              	.L51:
 331:FATFS/Target/user_diskio_spi.c **** 
 332:FATFS/Target/user_diskio_spi.c **** 	FCLK_SLOW();
 835              		.loc 1 332 2
 836 002a 694B     		ldr	r3, .L73+4
 837 002c 1B68     		ldr	r3, [r3]
 838 002e 1B68     		ldr	r3, [r3]
 839 0030 23F03802 		bic	r2, r3, #56
 840 0034 664B     		ldr	r3, .L73+4
 841 0036 1B68     		ldr	r3, [r3]
 842 0038 42F03002 		orr	r2, r2, #48
 843 003c 1A60     		str	r2, [r3]
 333:FATFS/Target/user_diskio_spi.c **** 	for (n = 10; n; n--) xchg_spi(0xFF);	/* Send 80 dummy clocks */
 844              		.loc 1 333 9
 845 003e 0A23     		movs	r3, #10
 846 0040 FB73     		strb	r3, [r7, #15]
 847              		.loc 1 333 2
 848 0042 05E0     		b	.L52
 849              	.L53:
 850              		.loc 1 333 23 discriminator 3
 851 0044 FF20     		movs	r0, #255
 852 0046 FFF7FEFF 		bl	xchg_spi
 853              		.loc 1 333 19 discriminator 3
 854 004a FB7B     		ldrb	r3, [r7, #15]	@ zero_extendqisi2
 855 004c 013B     		subs	r3, r3, #1
 856 004e FB73     		strb	r3, [r7, #15]
 857              	.L52:
 858              		.loc 1 333 15 discriminator 1
 859 0050 FB7B     		ldrb	r3, [r7, #15]	@ zero_extendqisi2
 860 0052 002B     		cmp	r3, #0
 861 0054 F6D1     		bne	.L53
 334:FATFS/Target/user_diskio_spi.c **** 
 335:FATFS/Target/user_diskio_spi.c **** 	ty = 0;
 862              		.loc 1 335 5
 863 0056 0023     		movs	r3, #0
 864 0058 7B73     		strb	r3, [r7, #13]
 336:FATFS/Target/user_diskio_spi.c **** 	if (send_cmd(CMD0, 0) == 1) {			/* Put the card SPI/Idle state */
 865              		.loc 1 336 6
 866 005a 0021     		movs	r1, #0
 867 005c 0020     		movs	r0, #0
 868 005e FFF7FEFF 		bl	send_cmd
 869 0062 0346     		mov	r3, r0
 870              		.loc 1 336 5
 871 0064 012B     		cmp	r3, #1
 872 0066 40F08B80 		bne	.L54
 337:FATFS/Target/user_diskio_spi.c **** 		SPI_Timer_On(1000);					/* Initialization timeout = 1 sec */
 873              		.loc 1 337 3
 874 006a 4FF47A70 		mov	r0, #1000
 875 006e FFF7FEFF 		bl	SPI_Timer_On
 338:FATFS/Target/user_diskio_spi.c **** 		if (send_cmd(CMD8, 0x1AA) == 1) {	/* SDv2? */
 876              		.loc 1 338 7
 877 0072 4FF4D571 		mov	r1, #426
 878 0076 0820     		movs	r0, #8
 879 0078 FFF7FEFF 		bl	send_cmd
 880 007c 0346     		mov	r3, r0
 881              		.loc 1 338 6
 882 007e 012B     		cmp	r3, #1
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 22


 883 0080 51D1     		bne	.L55
 339:FATFS/Target/user_diskio_spi.c **** 			for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);	/* Get 32 bit return value of R7 resp */
 884              		.loc 1 339 11
 885 0082 0023     		movs	r3, #0
 886 0084 FB73     		strb	r3, [r7, #15]
 887              		.loc 1 339 4
 888 0086 0DE0     		b	.L56
 889              	.L57:
 890              		.loc 1 339 31 discriminator 3
 891 0088 FC7B     		ldrb	r4, [r7, #15]	@ zero_extendqisi2
 892              		.loc 1 339 37 discriminator 3
 893 008a FF20     		movs	r0, #255
 894 008c FFF7FEFF 		bl	xchg_spi
 895 0090 0346     		mov	r3, r0
 896 0092 1A46     		mov	r2, r3
 897              		.loc 1 339 35 discriminator 3
 898 0094 04F11003 		add	r3, r4, #16
 899 0098 3B44     		add	r3, r3, r7
 900 009a 03F8082C 		strb	r2, [r3, #-8]
 901              		.loc 1 339 24 discriminator 3
 902 009e FB7B     		ldrb	r3, [r7, #15]	@ zero_extendqisi2
 903 00a0 0133     		adds	r3, r3, #1
 904 00a2 FB73     		strb	r3, [r7, #15]
 905              	.L56:
 906              		.loc 1 339 18 discriminator 1
 907 00a4 FB7B     		ldrb	r3, [r7, #15]	@ zero_extendqisi2
 908 00a6 032B     		cmp	r3, #3
 909 00a8 EED9     		bls	.L57
 340:FATFS/Target/user_diskio_spi.c **** 			if (ocr[2] == 0x01 && ocr[3] == 0xAA) {				/* Is the card supports vcc of 2.7-3.6V? */
 910              		.loc 1 340 11
 911 00aa BB7A     		ldrb	r3, [r7, #10]	@ zero_extendqisi2
 912              		.loc 1 340 7
 913 00ac 012B     		cmp	r3, #1
 914 00ae 67D1     		bne	.L54
 915              		.loc 1 340 29 discriminator 1
 916 00b0 FB7A     		ldrb	r3, [r7, #11]	@ zero_extendqisi2
 917              		.loc 1 340 23 discriminator 1
 918 00b2 AA2B     		cmp	r3, #170
 919 00b4 64D1     		bne	.L54
 341:FATFS/Target/user_diskio_spi.c **** 				while (SPI_Timer_Status() && send_cmd(ACMD41, 1UL << 30)) ;	/* Wait for end of initialization w
 920              		.loc 1 341 11
 921 00b6 00BF     		nop
 922              	.L59:
 923              		.loc 1 341 12 discriminator 2
 924 00b8 FFF7FEFF 		bl	SPI_Timer_Status
 925 00bc 0346     		mov	r3, r0
 926              		.loc 1 341 31 discriminator 2
 927 00be 002B     		cmp	r3, #0
 928 00c0 07D0     		beq	.L58
 929              		.loc 1 341 34 discriminator 1
 930 00c2 4FF08041 		mov	r1, #1073741824
 931 00c6 A920     		movs	r0, #169
 932 00c8 FFF7FEFF 		bl	send_cmd
 933 00cc 0346     		mov	r3, r0
 934              		.loc 1 341 31 discriminator 1
 935 00ce 002B     		cmp	r3, #0
 936 00d0 F2D1     		bne	.L59
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 23


 937              	.L58:
 342:FATFS/Target/user_diskio_spi.c **** 				if (SPI_Timer_Status() && send_cmd(CMD58, 0) == 0) {		/* Check CCS bit in the OCR */
 938              		.loc 1 342 9
 939 00d2 FFF7FEFF 		bl	SPI_Timer_Status
 940 00d6 0346     		mov	r3, r0
 941              		.loc 1 342 8
 942 00d8 002B     		cmp	r3, #0
 943 00da 51D0     		beq	.L54
 944              		.loc 1 342 31 discriminator 1
 945 00dc 0021     		movs	r1, #0
 946 00de 3A20     		movs	r0, #58
 947 00e0 FFF7FEFF 		bl	send_cmd
 948 00e4 0346     		mov	r3, r0
 949              		.loc 1 342 28 discriminator 1
 950 00e6 002B     		cmp	r3, #0
 951 00e8 4AD1     		bne	.L54
 343:FATFS/Target/user_diskio_spi.c **** 					for (n = 0; n < 4; n++) ocr[n] = xchg_spi(0xFF);
 952              		.loc 1 343 13
 953 00ea 0023     		movs	r3, #0
 954 00ec FB73     		strb	r3, [r7, #15]
 955              		.loc 1 343 6
 956 00ee 0DE0     		b	.L60
 957              	.L61:
 958              		.loc 1 343 33 discriminator 3
 959 00f0 FC7B     		ldrb	r4, [r7, #15]	@ zero_extendqisi2
 960              		.loc 1 343 39 discriminator 3
 961 00f2 FF20     		movs	r0, #255
 962 00f4 FFF7FEFF 		bl	xchg_spi
 963 00f8 0346     		mov	r3, r0
 964 00fa 1A46     		mov	r2, r3
 965              		.loc 1 343 37 discriminator 3
 966 00fc 04F11003 		add	r3, r4, #16
 967 0100 3B44     		add	r3, r3, r7
 968 0102 03F8082C 		strb	r2, [r3, #-8]
 969              		.loc 1 343 26 discriminator 3
 970 0106 FB7B     		ldrb	r3, [r7, #15]	@ zero_extendqisi2
 971 0108 0133     		adds	r3, r3, #1
 972 010a FB73     		strb	r3, [r7, #15]
 973              	.L60:
 974              		.loc 1 343 20 discriminator 1
 975 010c FB7B     		ldrb	r3, [r7, #15]	@ zero_extendqisi2
 976 010e 032B     		cmp	r3, #3
 977 0110 EED9     		bls	.L61
 344:FATFS/Target/user_diskio_spi.c **** 					ty = (ocr[0] & 0x40) ? CT_SD2 | CT_BLOCK : CT_SD2;	/* Card id SDv2 */
 978              		.loc 1 344 15
 979 0112 3B7A     		ldrb	r3, [r7, #8]	@ zero_extendqisi2
 980              		.loc 1 344 19
 981 0114 03F04003 		and	r3, r3, #64
 982              		.loc 1 344 9
 983 0118 002B     		cmp	r3, #0
 984 011a 01D0     		beq	.L62
 985              		.loc 1 344 9 is_stmt 0 discriminator 1
 986 011c 0C23     		movs	r3, #12
 987 011e 00E0     		b	.L63
 988              	.L62:
 989              		.loc 1 344 9 discriminator 2
 990 0120 0423     		movs	r3, #4
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 24


 991              	.L63:
 992              		.loc 1 344 9 discriminator 4
 993 0122 7B73     		strb	r3, [r7, #13]
 994 0124 2CE0     		b	.L54
 995              	.L55:
 345:FATFS/Target/user_diskio_spi.c **** 				}
 346:FATFS/Target/user_diskio_spi.c **** 			}
 347:FATFS/Target/user_diskio_spi.c **** 		} else {	/* Not SDv2 card */
 348:FATFS/Target/user_diskio_spi.c **** 			if (send_cmd(ACMD41, 0) <= 1) 	{	/* SDv1 or MMC? */
 996              		.loc 1 348 8 is_stmt 1
 997 0126 0021     		movs	r1, #0
 998 0128 A920     		movs	r0, #169
 999 012a FFF7FEFF 		bl	send_cmd
 1000 012e 0346     		mov	r3, r0
 1001              		.loc 1 348 7
 1002 0130 012B     		cmp	r3, #1
 1003 0132 04D8     		bhi	.L64
 349:FATFS/Target/user_diskio_spi.c **** 				ty = CT_SD1; cmd = ACMD41;	/* SDv1 (ACMD41(0)) */
 1004              		.loc 1 349 8
 1005 0134 0223     		movs	r3, #2
 1006 0136 7B73     		strb	r3, [r7, #13]
 1007              		.loc 1 349 22
 1008 0138 A923     		movs	r3, #169
 1009 013a BB73     		strb	r3, [r7, #14]
 1010 013c 03E0     		b	.L72
 1011              	.L64:
 350:FATFS/Target/user_diskio_spi.c **** 			} else {
 351:FATFS/Target/user_diskio_spi.c **** 				ty = CT_MMC; cmd = CMD1;	/* MMCv3 (CMD1(0)) */
 1012              		.loc 1 351 8
 1013 013e 0123     		movs	r3, #1
 1014 0140 7B73     		strb	r3, [r7, #13]
 1015              		.loc 1 351 22
 1016 0142 0123     		movs	r3, #1
 1017 0144 BB73     		strb	r3, [r7, #14]
 1018              	.L72:
 352:FATFS/Target/user_diskio_spi.c **** 			}
 353:FATFS/Target/user_diskio_spi.c **** 			while (SPI_Timer_Status() && send_cmd(cmd, 0)) ;		/* Wait for end of initialization */
 1019              		.loc 1 353 10
 1020 0146 00BF     		nop
 1021              	.L67:
 1022              		.loc 1 353 11 discriminator 2
 1023 0148 FFF7FEFF 		bl	SPI_Timer_Status
 1024 014c 0346     		mov	r3, r0
 1025              		.loc 1 353 30 discriminator 2
 1026 014e 002B     		cmp	r3, #0
 1027 0150 07D0     		beq	.L66
 1028              		.loc 1 353 33 discriminator 1
 1029 0152 BB7B     		ldrb	r3, [r7, #14]	@ zero_extendqisi2
 1030 0154 0021     		movs	r1, #0
 1031 0156 1846     		mov	r0, r3
 1032 0158 FFF7FEFF 		bl	send_cmd
 1033 015c 0346     		mov	r3, r0
 1034              		.loc 1 353 30 discriminator 1
 1035 015e 002B     		cmp	r3, #0
 1036 0160 F2D1     		bne	.L67
 1037              	.L66:
 354:FATFS/Target/user_diskio_spi.c **** 			if (!SPI_Timer_Status() || send_cmd(CMD16, 512) != 0)	/* Set block length: 512 */
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 25


 1038              		.loc 1 354 9
 1039 0162 FFF7FEFF 		bl	SPI_Timer_Status
 1040 0166 0346     		mov	r3, r0
 1041              		.loc 1 354 7
 1042 0168 002B     		cmp	r3, #0
 1043 016a 07D0     		beq	.L68
 1044              		.loc 1 354 31 discriminator 1
 1045 016c 4FF40071 		mov	r1, #512
 1046 0170 1020     		movs	r0, #16
 1047 0172 FFF7FEFF 		bl	send_cmd
 1048 0176 0346     		mov	r3, r0
 1049              		.loc 1 354 28 discriminator 1
 1050 0178 002B     		cmp	r3, #0
 1051 017a 01D0     		beq	.L54
 1052              	.L68:
 355:FATFS/Target/user_diskio_spi.c **** 				ty = 0;
 1053              		.loc 1 355 8
 1054 017c 0023     		movs	r3, #0
 1055 017e 7B73     		strb	r3, [r7, #13]
 1056              	.L54:
 356:FATFS/Target/user_diskio_spi.c **** 		}
 357:FATFS/Target/user_diskio_spi.c **** 	}
 358:FATFS/Target/user_diskio_spi.c **** 	CardType = ty;	/* Card type */
 1057              		.loc 1 358 11
 1058 0180 144A     		ldr	r2, .L73+8
 1059 0182 7B7B     		ldrb	r3, [r7, #13]
 1060 0184 1370     		strb	r3, [r2]
 359:FATFS/Target/user_diskio_spi.c **** 	despiselect();
 1061              		.loc 1 359 2
 1062 0186 FFF7FEFF 		bl	despiselect
 360:FATFS/Target/user_diskio_spi.c **** 
 361:FATFS/Target/user_diskio_spi.c **** 	if (ty) {			/* OK */
 1063              		.loc 1 361 5
 1064 018a 7B7B     		ldrb	r3, [r7, #13]	@ zero_extendqisi2
 1065 018c 002B     		cmp	r3, #0
 1066 018e 12D0     		beq	.L69
 362:FATFS/Target/user_diskio_spi.c **** 		FCLK_FAST();			/* Set fast clock */
 1067              		.loc 1 362 3
 1068 0190 0F4B     		ldr	r3, .L73+4
 1069 0192 1B68     		ldr	r3, [r3]
 1070 0194 1B68     		ldr	r3, [r3]
 1071 0196 23F03802 		bic	r2, r3, #56
 1072 019a 0D4B     		ldr	r3, .L73+4
 1073 019c 1B68     		ldr	r3, [r3]
 1074 019e 42F01002 		orr	r2, r2, #16
 1075 01a2 1A60     		str	r2, [r3]
 363:FATFS/Target/user_diskio_spi.c **** 		Stat &= ~STA_NOINIT;	/* Clear STA_NOINIT flag */
 1076              		.loc 1 363 8
 1077 01a4 094B     		ldr	r3, .L73
 1078 01a6 1B78     		ldrb	r3, [r3]
 1079 01a8 DBB2     		uxtb	r3, r3
 1080 01aa 23F00103 		bic	r3, r3, #1
 1081 01ae DAB2     		uxtb	r2, r3
 1082 01b0 064B     		ldr	r3, .L73
 1083 01b2 1A70     		strb	r2, [r3]
 1084 01b4 02E0     		b	.L70
 1085              	.L69:
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 26


 364:FATFS/Target/user_diskio_spi.c **** 	} else {			/* Failed */
 365:FATFS/Target/user_diskio_spi.c **** 		Stat = STA_NOINIT;
 1086              		.loc 1 365 8
 1087 01b6 054B     		ldr	r3, .L73
 1088 01b8 0122     		movs	r2, #1
 1089 01ba 1A70     		strb	r2, [r3]
 1090              	.L70:
 366:FATFS/Target/user_diskio_spi.c **** 	}
 367:FATFS/Target/user_diskio_spi.c **** 
 368:FATFS/Target/user_diskio_spi.c **** 	return Stat;
 1091              		.loc 1 368 9
 1092 01bc 034B     		ldr	r3, .L73
 1093 01be 1B78     		ldrb	r3, [r3]
 1094 01c0 DBB2     		uxtb	r3, r3
 1095              	.L71:
 369:FATFS/Target/user_diskio_spi.c **** }
 1096              		.loc 1 369 1 discriminator 1
 1097 01c2 1846     		mov	r0, r3
 1098 01c4 1437     		adds	r7, r7, #20
 1099              		.cfi_def_cfa_offset 12
 1100 01c6 BD46     		mov	sp, r7
 1101              		.cfi_def_cfa_register 13
 1102              		@ sp needed
 1103 01c8 90BD     		pop	{r4, r7, pc}
 1104              	.L74:
 1105 01ca 00BF     		.align	2
 1106              	.L73:
 1107 01cc 00000000 		.word	Stat
 1108 01d0 00000000 		.word	hspi2
 1109 01d4 00000000 		.word	CardType
 1110              		.cfi_endproc
 1111              	.LFE332:
 1113              		.section	.text.USER_SPI_status,"ax",%progbits
 1114              		.align	1
 1115              		.global	USER_SPI_status
 1116              		.syntax unified
 1117              		.thumb
 1118              		.thumb_func
 1120              	USER_SPI_status:
 1121              	.LFB333:
 370:FATFS/Target/user_diskio_spi.c **** 
 371:FATFS/Target/user_diskio_spi.c **** 
 372:FATFS/Target/user_diskio_spi.c **** 
 373:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 374:FATFS/Target/user_diskio_spi.c **** /* Get disk status                                                       */
 375:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 376:FATFS/Target/user_diskio_spi.c **** 
 377:FATFS/Target/user_diskio_spi.c **** inline DSTATUS USER_SPI_status (
 378:FATFS/Target/user_diskio_spi.c **** 	BYTE drv		/* Physical drive number (0) */
 379:FATFS/Target/user_diskio_spi.c **** )
 380:FATFS/Target/user_diskio_spi.c **** {
 1122              		.loc 1 380 1
 1123              		.cfi_startproc
 1124              		@ args = 0, pretend = 0, frame = 8
 1125              		@ frame_needed = 1, uses_anonymous_args = 0
 1126              		@ link register save eliminated.
 1127 0000 80B4     		push	{r7}
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 27


 1128              		.cfi_def_cfa_offset 4
 1129              		.cfi_offset 7, -4
 1130 0002 83B0     		sub	sp, sp, #12
 1131              		.cfi_def_cfa_offset 16
 1132 0004 00AF     		add	r7, sp, #0
 1133              		.cfi_def_cfa_register 7
 1134 0006 0346     		mov	r3, r0
 1135 0008 FB71     		strb	r3, [r7, #7]
 381:FATFS/Target/user_diskio_spi.c **** 	if (drv) return STA_NOINIT;		/* Supports only drive 0 */
 1136              		.loc 1 381 5
 1137 000a FB79     		ldrb	r3, [r7, #7]	@ zero_extendqisi2
 1138 000c 002B     		cmp	r3, #0
 1139 000e 01D0     		beq	.L76
 1140              		.loc 1 381 18 discriminator 1
 1141 0010 0123     		movs	r3, #1
 1142 0012 02E0     		b	.L77
 1143              	.L76:
 382:FATFS/Target/user_diskio_spi.c **** 
 383:FATFS/Target/user_diskio_spi.c **** 	return Stat;	/* Return disk status */
 1144              		.loc 1 383 9
 1145 0014 044B     		ldr	r3, .L78
 1146 0016 1B78     		ldrb	r3, [r3]
 1147 0018 DBB2     		uxtb	r3, r3
 1148              	.L77:
 384:FATFS/Target/user_diskio_spi.c **** }
 1149              		.loc 1 384 1
 1150 001a 1846     		mov	r0, r3
 1151 001c 0C37     		adds	r7, r7, #12
 1152              		.cfi_def_cfa_offset 4
 1153 001e BD46     		mov	sp, r7
 1154              		.cfi_def_cfa_register 13
 1155              		@ sp needed
 1156 0020 5DF8047B 		ldr	r7, [sp], #4
 1157              		.cfi_restore 7
 1158              		.cfi_def_cfa_offset 0
 1159 0024 7047     		bx	lr
 1160              	.L79:
 1161 0026 00BF     		.align	2
 1162              	.L78:
 1163 0028 00000000 		.word	Stat
 1164              		.cfi_endproc
 1165              	.LFE333:
 1167              		.section	.text.USER_SPI_read,"ax",%progbits
 1168              		.align	1
 1169              		.global	USER_SPI_read
 1170              		.syntax unified
 1171              		.thumb
 1172              		.thumb_func
 1174              	USER_SPI_read:
 1175              	.LFB334:
 385:FATFS/Target/user_diskio_spi.c **** 
 386:FATFS/Target/user_diskio_spi.c **** 
 387:FATFS/Target/user_diskio_spi.c **** 
 388:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 389:FATFS/Target/user_diskio_spi.c **** /* Read sector(s)                                                        */
 390:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 391:FATFS/Target/user_diskio_spi.c **** 
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 28


 392:FATFS/Target/user_diskio_spi.c **** inline DRESULT USER_SPI_read (
 393:FATFS/Target/user_diskio_spi.c **** 	BYTE drv,		/* Physical drive number (0) */
 394:FATFS/Target/user_diskio_spi.c **** 	BYTE *buff,		/* Pointer to the data buffer to store read data */
 395:FATFS/Target/user_diskio_spi.c **** 	DWORD sector,	/* Start sector number (LBA) */
 396:FATFS/Target/user_diskio_spi.c **** 	UINT count		/* Number of sectors to read (1..128) */
 397:FATFS/Target/user_diskio_spi.c **** )
 398:FATFS/Target/user_diskio_spi.c **** {
 1176              		.loc 1 398 1
 1177              		.cfi_startproc
 1178              		@ args = 0, pretend = 0, frame = 16
 1179              		@ frame_needed = 1, uses_anonymous_args = 0
 1180 0000 80B5     		push	{r7, lr}
 1181              		.cfi_def_cfa_offset 8
 1182              		.cfi_offset 7, -8
 1183              		.cfi_offset 14, -4
 1184 0002 84B0     		sub	sp, sp, #16
 1185              		.cfi_def_cfa_offset 24
 1186 0004 00AF     		add	r7, sp, #0
 1187              		.cfi_def_cfa_register 7
 1188 0006 B960     		str	r1, [r7, #8]
 1189 0008 7A60     		str	r2, [r7, #4]
 1190 000a 3B60     		str	r3, [r7]
 1191 000c 0346     		mov	r3, r0
 1192 000e FB73     		strb	r3, [r7, #15]
 399:FATFS/Target/user_diskio_spi.c **** 	if (drv || !count) return RES_PARERR;		/* Check parameter */
 1193              		.loc 1 399 5
 1194 0010 FB7B     		ldrb	r3, [r7, #15]	@ zero_extendqisi2
 1195 0012 002B     		cmp	r3, #0
 1196 0014 02D1     		bne	.L81
 1197              		.loc 1 399 10 discriminator 2
 1198 0016 3B68     		ldr	r3, [r7]
 1199 0018 002B     		cmp	r3, #0
 1200 001a 01D1     		bne	.L82
 1201              	.L81:
 1202              		.loc 1 399 28 discriminator 3
 1203 001c 0423     		movs	r3, #4
 1204 001e 4DE0     		b	.L83
 1205              	.L82:
 400:FATFS/Target/user_diskio_spi.c **** 	if (Stat & STA_NOINIT) return RES_NOTRDY;	/* Check if drive is ready */
 1206              		.loc 1 400 11
 1207 0020 284B     		ldr	r3, .L92
 1208 0022 1B78     		ldrb	r3, [r3]
 1209 0024 DBB2     		uxtb	r3, r3
 1210 0026 03F00103 		and	r3, r3, #1
 1211              		.loc 1 400 5
 1212 002a 002B     		cmp	r3, #0
 1213 002c 01D0     		beq	.L84
 1214              		.loc 1 400 32 discriminator 1
 1215 002e 0323     		movs	r3, #3
 1216 0030 44E0     		b	.L83
 1217              	.L84:
 401:FATFS/Target/user_diskio_spi.c **** 
 402:FATFS/Target/user_diskio_spi.c **** 	if (!(CardType & CT_BLOCK)) sector *= 512;	/* LBA ot BA conversion (byte addressing cards) */
 1218              		.loc 1 402 17
 1219 0032 254B     		ldr	r3, .L92+4
 1220 0034 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1221 0036 03F00803 		and	r3, r3, #8
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 29


 1222              		.loc 1 402 5
 1223 003a 002B     		cmp	r3, #0
 1224 003c 02D1     		bne	.L85
 1225              		.loc 1 402 37 discriminator 1
 1226 003e 7B68     		ldr	r3, [r7, #4]
 1227 0040 5B02     		lsls	r3, r3, #9
 1228 0042 7B60     		str	r3, [r7, #4]
 1229              	.L85:
 403:FATFS/Target/user_diskio_spi.c **** 
 404:FATFS/Target/user_diskio_spi.c **** 	if (count == 1) {	/* Single sector read */
 1230              		.loc 1 404 5
 1231 0044 3B68     		ldr	r3, [r7]
 1232 0046 012B     		cmp	r3, #1
 1233 0048 11D1     		bne	.L86
 405:FATFS/Target/user_diskio_spi.c **** 		if ((send_cmd(CMD17, sector) == 0)	/* READ_SINGLE_BLOCK */
 1234              		.loc 1 405 8
 1235 004a 7968     		ldr	r1, [r7, #4]
 1236 004c 1120     		movs	r0, #17
 1237 004e FFF7FEFF 		bl	send_cmd
 1238 0052 0346     		mov	r3, r0
 1239              		.loc 1 405 6
 1240 0054 002B     		cmp	r3, #0
 1241 0056 29D1     		bne	.L87
 406:FATFS/Target/user_diskio_spi.c **** 			&& rcvr_datablock(buff, 512)) {
 1242              		.loc 1 406 7
 1243 0058 4FF40071 		mov	r1, #512
 1244 005c B868     		ldr	r0, [r7, #8]
 1245 005e FFF7FEFF 		bl	rcvr_datablock
 1246 0062 0346     		mov	r3, r0
 1247              		.loc 1 406 4
 1248 0064 002B     		cmp	r3, #0
 1249 0066 21D0     		beq	.L87
 407:FATFS/Target/user_diskio_spi.c **** 			count = 0;
 1250              		.loc 1 407 10
 1251 0068 0023     		movs	r3, #0
 1252 006a 3B60     		str	r3, [r7]
 1253 006c 1EE0     		b	.L87
 1254              	.L86:
 408:FATFS/Target/user_diskio_spi.c **** 		}
 409:FATFS/Target/user_diskio_spi.c **** 	}
 410:FATFS/Target/user_diskio_spi.c **** 	else {				/* Multiple sector read */
 411:FATFS/Target/user_diskio_spi.c **** 		if (send_cmd(CMD18, sector) == 0) {	/* READ_MULTIPLE_BLOCK */
 1255              		.loc 1 411 7
 1256 006e 7968     		ldr	r1, [r7, #4]
 1257 0070 1220     		movs	r0, #18
 1258 0072 FFF7FEFF 		bl	send_cmd
 1259 0076 0346     		mov	r3, r0
 1260              		.loc 1 411 6
 1261 0078 002B     		cmp	r3, #0
 1262 007a 17D1     		bne	.L87
 1263              	.L90:
 412:FATFS/Target/user_diskio_spi.c **** 			do {
 413:FATFS/Target/user_diskio_spi.c **** 				if (!rcvr_datablock(buff, 512)) break;
 1264              		.loc 1 413 10
 1265 007c 4FF40071 		mov	r1, #512
 1266 0080 B868     		ldr	r0, [r7, #8]
 1267 0082 FFF7FEFF 		bl	rcvr_datablock
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 30


 1268 0086 0346     		mov	r3, r0
 1269              		.loc 1 413 8
 1270 0088 002B     		cmp	r3, #0
 1271 008a 0AD0     		beq	.L91
 414:FATFS/Target/user_diskio_spi.c **** 				buff += 512;
 1272              		.loc 1 414 10
 1273 008c BB68     		ldr	r3, [r7, #8]
 1274 008e 03F50073 		add	r3, r3, #512
 1275 0092 BB60     		str	r3, [r7, #8]
 415:FATFS/Target/user_diskio_spi.c **** 			} while (--count);
 1276              		.loc 1 415 13
 1277 0094 3B68     		ldr	r3, [r7]
 1278 0096 013B     		subs	r3, r3, #1
 1279 0098 3B60     		str	r3, [r7]
 1280 009a 3B68     		ldr	r3, [r7]
 1281 009c 002B     		cmp	r3, #0
 1282 009e EDD1     		bne	.L90
 1283 00a0 00E0     		b	.L89
 1284              	.L91:
 413:FATFS/Target/user_diskio_spi.c **** 				buff += 512;
 1285              		.loc 1 413 37
 1286 00a2 00BF     		nop
 1287              	.L89:
 416:FATFS/Target/user_diskio_spi.c **** 			send_cmd(CMD12, 0);				/* STOP_TRANSMISSION */
 1288              		.loc 1 416 4
 1289 00a4 0021     		movs	r1, #0
 1290 00a6 0C20     		movs	r0, #12
 1291 00a8 FFF7FEFF 		bl	send_cmd
 1292              	.L87:
 417:FATFS/Target/user_diskio_spi.c **** 		}
 418:FATFS/Target/user_diskio_spi.c **** 	}
 419:FATFS/Target/user_diskio_spi.c **** 	despiselect();
 1293              		.loc 1 419 2
 1294 00ac FFF7FEFF 		bl	despiselect
 420:FATFS/Target/user_diskio_spi.c **** 
 421:FATFS/Target/user_diskio_spi.c **** 	return count ? RES_ERROR : RES_OK;	/* Return result */
 1295              		.loc 1 421 27
 1296 00b0 3B68     		ldr	r3, [r7]
 1297 00b2 002B     		cmp	r3, #0
 1298 00b4 14BF     		ite	ne
 1299 00b6 0123     		movne	r3, #1
 1300 00b8 0023     		moveq	r3, #0
 1301 00ba DBB2     		uxtb	r3, r3
 1302              	.L83:
 422:FATFS/Target/user_diskio_spi.c **** }
 1303              		.loc 1 422 1
 1304 00bc 1846     		mov	r0, r3
 1305 00be 1037     		adds	r7, r7, #16
 1306              		.cfi_def_cfa_offset 8
 1307 00c0 BD46     		mov	sp, r7
 1308              		.cfi_def_cfa_register 13
 1309              		@ sp needed
 1310 00c2 80BD     		pop	{r7, pc}
 1311              	.L93:
 1312              		.align	2
 1313              	.L92:
 1314 00c4 00000000 		.word	Stat
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 31


 1315 00c8 00000000 		.word	CardType
 1316              		.cfi_endproc
 1317              	.LFE334:
 1319              		.section	.text.USER_SPI_write,"ax",%progbits
 1320              		.align	1
 1321              		.global	USER_SPI_write
 1322              		.syntax unified
 1323              		.thumb
 1324              		.thumb_func
 1326              	USER_SPI_write:
 1327              	.LFB335:
 423:FATFS/Target/user_diskio_spi.c **** 
 424:FATFS/Target/user_diskio_spi.c **** 
 425:FATFS/Target/user_diskio_spi.c **** 
 426:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 427:FATFS/Target/user_diskio_spi.c **** /* Write sector(s)                                                       */
 428:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 429:FATFS/Target/user_diskio_spi.c **** 
 430:FATFS/Target/user_diskio_spi.c **** #if _USE_WRITE
 431:FATFS/Target/user_diskio_spi.c **** inline DRESULT USER_SPI_write (
 432:FATFS/Target/user_diskio_spi.c **** 	BYTE drv,			/* Physical drive number (0) */
 433:FATFS/Target/user_diskio_spi.c **** 	const BYTE *buff,	/* Ponter to the data to write */
 434:FATFS/Target/user_diskio_spi.c **** 	DWORD sector,		/* Start sector number (LBA) */
 435:FATFS/Target/user_diskio_spi.c **** 	UINT count			/* Number of sectors to write (1..128) */
 436:FATFS/Target/user_diskio_spi.c **** )
 437:FATFS/Target/user_diskio_spi.c **** {
 1328              		.loc 1 437 1
 1329              		.cfi_startproc
 1330              		@ args = 0, pretend = 0, frame = 16
 1331              		@ frame_needed = 1, uses_anonymous_args = 0
 1332 0000 80B5     		push	{r7, lr}
 1333              		.cfi_def_cfa_offset 8
 1334              		.cfi_offset 7, -8
 1335              		.cfi_offset 14, -4
 1336 0002 84B0     		sub	sp, sp, #16
 1337              		.cfi_def_cfa_offset 24
 1338 0004 00AF     		add	r7, sp, #0
 1339              		.cfi_def_cfa_register 7
 1340 0006 B960     		str	r1, [r7, #8]
 1341 0008 7A60     		str	r2, [r7, #4]
 1342 000a 3B60     		str	r3, [r7]
 1343 000c 0346     		mov	r3, r0
 1344 000e FB73     		strb	r3, [r7, #15]
 438:FATFS/Target/user_diskio_spi.c **** 	if (drv || !count) return RES_PARERR;		/* Check parameter */
 1345              		.loc 1 438 5
 1346 0010 FB7B     		ldrb	r3, [r7, #15]	@ zero_extendqisi2
 1347 0012 002B     		cmp	r3, #0
 1348 0014 02D1     		bne	.L95
 1349              		.loc 1 438 10 discriminator 2
 1350 0016 3B68     		ldr	r3, [r7]
 1351 0018 002B     		cmp	r3, #0
 1352 001a 01D1     		bne	.L96
 1353              	.L95:
 1354              		.loc 1 438 28 discriminator 3
 1355 001c 0423     		movs	r3, #4
 1356 001e 63E0     		b	.L97
 1357              	.L96:
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 32


 439:FATFS/Target/user_diskio_spi.c **** 	if (Stat & STA_NOINIT) return RES_NOTRDY;	/* Check drive status */
 1358              		.loc 1 439 11
 1359 0020 334B     		ldr	r3, .L108
 1360 0022 1B78     		ldrb	r3, [r3]
 1361 0024 DBB2     		uxtb	r3, r3
 1362 0026 03F00103 		and	r3, r3, #1
 1363              		.loc 1 439 5
 1364 002a 002B     		cmp	r3, #0
 1365 002c 01D0     		beq	.L98
 1366              		.loc 1 439 32 discriminator 1
 1367 002e 0323     		movs	r3, #3
 1368 0030 5AE0     		b	.L97
 1369              	.L98:
 440:FATFS/Target/user_diskio_spi.c **** 	if (Stat & STA_PROTECT) return RES_WRPRT;	/* Check write protect */
 1370              		.loc 1 440 11
 1371 0032 2F4B     		ldr	r3, .L108
 1372 0034 1B78     		ldrb	r3, [r3]
 1373 0036 DBB2     		uxtb	r3, r3
 1374 0038 03F00403 		and	r3, r3, #4
 1375              		.loc 1 440 5
 1376 003c 002B     		cmp	r3, #0
 1377 003e 01D0     		beq	.L99
 1378              		.loc 1 440 33 discriminator 1
 1379 0040 0223     		movs	r3, #2
 1380 0042 51E0     		b	.L97
 1381              	.L99:
 441:FATFS/Target/user_diskio_spi.c **** 
 442:FATFS/Target/user_diskio_spi.c **** 	if (!(CardType & CT_BLOCK)) sector *= 512;	/* LBA ==> BA conversion (byte addressing cards) */
 1382              		.loc 1 442 17
 1383 0044 2B4B     		ldr	r3, .L108+4
 1384 0046 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1385 0048 03F00803 		and	r3, r3, #8
 1386              		.loc 1 442 5
 1387 004c 002B     		cmp	r3, #0
 1388 004e 02D1     		bne	.L100
 1389              		.loc 1 442 37 discriminator 1
 1390 0050 7B68     		ldr	r3, [r7, #4]
 1391 0052 5B02     		lsls	r3, r3, #9
 1392 0054 7B60     		str	r3, [r7, #4]
 1393              	.L100:
 443:FATFS/Target/user_diskio_spi.c **** 
 444:FATFS/Target/user_diskio_spi.c **** 	if (count == 1) {	/* Single sector write */
 1394              		.loc 1 444 5
 1395 0056 3B68     		ldr	r3, [r7]
 1396 0058 012B     		cmp	r3, #1
 1397 005a 10D1     		bne	.L101
 445:FATFS/Target/user_diskio_spi.c **** 		if ((send_cmd(CMD24, sector) == 0)	/* WRITE_BLOCK */
 1398              		.loc 1 445 8
 1399 005c 7968     		ldr	r1, [r7, #4]
 1400 005e 1820     		movs	r0, #24
 1401 0060 FFF7FEFF 		bl	send_cmd
 1402 0064 0346     		mov	r3, r0
 1403              		.loc 1 445 6
 1404 0066 002B     		cmp	r3, #0
 1405 0068 36D1     		bne	.L102
 446:FATFS/Target/user_diskio_spi.c **** 			&& xmit_datablock(buff, 0xFE)) {
 1406              		.loc 1 446 7
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 33


 1407 006a FE21     		movs	r1, #254
 1408 006c B868     		ldr	r0, [r7, #8]
 1409 006e FFF7FEFF 		bl	xmit_datablock
 1410 0072 0346     		mov	r3, r0
 1411              		.loc 1 446 4
 1412 0074 002B     		cmp	r3, #0
 1413 0076 2FD0     		beq	.L102
 447:FATFS/Target/user_diskio_spi.c **** 			count = 0;
 1414              		.loc 1 447 10
 1415 0078 0023     		movs	r3, #0
 1416 007a 3B60     		str	r3, [r7]
 1417 007c 2CE0     		b	.L102
 1418              	.L101:
 448:FATFS/Target/user_diskio_spi.c **** 		}
 449:FATFS/Target/user_diskio_spi.c **** 	}
 450:FATFS/Target/user_diskio_spi.c **** 	else {				/* Multiple sector write */
 451:FATFS/Target/user_diskio_spi.c **** 		if (CardType & CT_SDC) send_cmd(ACMD23, count);	/* Predefine number of sectors */
 1419              		.loc 1 451 16
 1420 007e 1D4B     		ldr	r3, .L108+4
 1421 0080 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1422 0082 03F00603 		and	r3, r3, #6
 1423              		.loc 1 451 6
 1424 0086 002B     		cmp	r3, #0
 1425 0088 03D0     		beq	.L103
 1426              		.loc 1 451 26 discriminator 1
 1427 008a 3968     		ldr	r1, [r7]
 1428 008c 9720     		movs	r0, #151
 1429 008e FFF7FEFF 		bl	send_cmd
 1430              	.L103:
 452:FATFS/Target/user_diskio_spi.c **** 		if (send_cmd(CMD25, sector) == 0) {	/* WRITE_MULTIPLE_BLOCK */
 1431              		.loc 1 452 7
 1432 0092 7968     		ldr	r1, [r7, #4]
 1433 0094 1920     		movs	r0, #25
 1434 0096 FFF7FEFF 		bl	send_cmd
 1435 009a 0346     		mov	r3, r0
 1436              		.loc 1 452 6
 1437 009c 002B     		cmp	r3, #0
 1438 009e 1BD1     		bne	.L102
 1439              	.L106:
 453:FATFS/Target/user_diskio_spi.c **** 			do {
 454:FATFS/Target/user_diskio_spi.c **** 				if (!xmit_datablock(buff, 0xFC)) break;
 1440              		.loc 1 454 10
 1441 00a0 FC21     		movs	r1, #252
 1442 00a2 B868     		ldr	r0, [r7, #8]
 1443 00a4 FFF7FEFF 		bl	xmit_datablock
 1444 00a8 0346     		mov	r3, r0
 1445              		.loc 1 454 8
 1446 00aa 002B     		cmp	r3, #0
 1447 00ac 0AD0     		beq	.L107
 455:FATFS/Target/user_diskio_spi.c **** 				buff += 512;
 1448              		.loc 1 455 10
 1449 00ae BB68     		ldr	r3, [r7, #8]
 1450 00b0 03F50073 		add	r3, r3, #512
 1451 00b4 BB60     		str	r3, [r7, #8]
 456:FATFS/Target/user_diskio_spi.c **** 			} while (--count);
 1452              		.loc 1 456 13
 1453 00b6 3B68     		ldr	r3, [r7]
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 34


 1454 00b8 013B     		subs	r3, r3, #1
 1455 00ba 3B60     		str	r3, [r7]
 1456 00bc 3B68     		ldr	r3, [r7]
 1457 00be 002B     		cmp	r3, #0
 1458 00c0 EED1     		bne	.L106
 1459 00c2 00E0     		b	.L105
 1460              	.L107:
 454:FATFS/Target/user_diskio_spi.c **** 				buff += 512;
 1461              		.loc 1 454 38
 1462 00c4 00BF     		nop
 1463              	.L105:
 457:FATFS/Target/user_diskio_spi.c **** 			if (!xmit_datablock(0, 0xFD)) count = 1;	/* STOP_TRAN token */
 1464              		.loc 1 457 9
 1465 00c6 FD21     		movs	r1, #253
 1466 00c8 0020     		movs	r0, #0
 1467 00ca FFF7FEFF 		bl	xmit_datablock
 1468 00ce 0346     		mov	r3, r0
 1469              		.loc 1 457 7
 1470 00d0 002B     		cmp	r3, #0
 1471 00d2 01D1     		bne	.L102
 1472              		.loc 1 457 40 discriminator 1
 1473 00d4 0123     		movs	r3, #1
 1474 00d6 3B60     		str	r3, [r7]
 1475              	.L102:
 458:FATFS/Target/user_diskio_spi.c **** 		}
 459:FATFS/Target/user_diskio_spi.c **** 	}
 460:FATFS/Target/user_diskio_spi.c **** 	despiselect();
 1476              		.loc 1 460 2
 1477 00d8 FFF7FEFF 		bl	despiselect
 461:FATFS/Target/user_diskio_spi.c **** 
 462:FATFS/Target/user_diskio_spi.c **** 	return count ? RES_ERROR : RES_OK;	/* Return result */
 1478              		.loc 1 462 27
 1479 00dc 3B68     		ldr	r3, [r7]
 1480 00de 002B     		cmp	r3, #0
 1481 00e0 14BF     		ite	ne
 1482 00e2 0123     		movne	r3, #1
 1483 00e4 0023     		moveq	r3, #0
 1484 00e6 DBB2     		uxtb	r3, r3
 1485              	.L97:
 463:FATFS/Target/user_diskio_spi.c **** }
 1486              		.loc 1 463 1
 1487 00e8 1846     		mov	r0, r3
 1488 00ea 1037     		adds	r7, r7, #16
 1489              		.cfi_def_cfa_offset 8
 1490 00ec BD46     		mov	sp, r7
 1491              		.cfi_def_cfa_register 13
 1492              		@ sp needed
 1493 00ee 80BD     		pop	{r7, pc}
 1494              	.L109:
 1495              		.align	2
 1496              	.L108:
 1497 00f0 00000000 		.word	Stat
 1498 00f4 00000000 		.word	CardType
 1499              		.cfi_endproc
 1500              	.LFE335:
 1502              		.section	.text.USER_SPI_ioctl,"ax",%progbits
 1503              		.align	1
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 35


 1504              		.global	USER_SPI_ioctl
 1505              		.syntax unified
 1506              		.thumb
 1507              		.thumb_func
 1509              	USER_SPI_ioctl:
 1510              	.LFB336:
 464:FATFS/Target/user_diskio_spi.c **** #endif
 465:FATFS/Target/user_diskio_spi.c **** 
 466:FATFS/Target/user_diskio_spi.c **** 
 467:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 468:FATFS/Target/user_diskio_spi.c **** /* Miscellaneous drive controls other than data read/write               */
 469:FATFS/Target/user_diskio_spi.c **** /*-----------------------------------------------------------------------*/
 470:FATFS/Target/user_diskio_spi.c **** 
 471:FATFS/Target/user_diskio_spi.c **** #if _USE_IOCTL
 472:FATFS/Target/user_diskio_spi.c **** inline DRESULT USER_SPI_ioctl (
 473:FATFS/Target/user_diskio_spi.c **** 	BYTE drv,		/* Physical drive number (0) */
 474:FATFS/Target/user_diskio_spi.c **** 	BYTE cmd,		/* Control command code */
 475:FATFS/Target/user_diskio_spi.c **** 	void *buff		/* Pointer to the conrtol data */
 476:FATFS/Target/user_diskio_spi.c **** )
 477:FATFS/Target/user_diskio_spi.c **** {
 1511              		.loc 1 477 1
 1512              		.cfi_startproc
 1513              		@ args = 0, pretend = 0, frame = 48
 1514              		@ frame_needed = 1, uses_anonymous_args = 0
 1515 0000 80B5     		push	{r7, lr}
 1516              		.cfi_def_cfa_offset 8
 1517              		.cfi_offset 7, -8
 1518              		.cfi_offset 14, -4
 1519 0002 8CB0     		sub	sp, sp, #48
 1520              		.cfi_def_cfa_offset 56
 1521 0004 00AF     		add	r7, sp, #0
 1522              		.cfi_def_cfa_register 7
 1523 0006 0346     		mov	r3, r0
 1524 0008 3A60     		str	r2, [r7]
 1525 000a FB71     		strb	r3, [r7, #7]
 1526 000c 0B46     		mov	r3, r1
 1527 000e BB71     		strb	r3, [r7, #6]
 478:FATFS/Target/user_diskio_spi.c **** 	DRESULT res;
 479:FATFS/Target/user_diskio_spi.c **** 	BYTE n, csd[16];
 480:FATFS/Target/user_diskio_spi.c **** 	DWORD *dp, st, ed, csize;
 481:FATFS/Target/user_diskio_spi.c **** 
 482:FATFS/Target/user_diskio_spi.c **** 
 483:FATFS/Target/user_diskio_spi.c **** 	if (drv) return RES_PARERR;					/* Check parameter */
 1528              		.loc 1 483 5
 1529 0010 FB79     		ldrb	r3, [r7, #7]	@ zero_extendqisi2
 1530 0012 002B     		cmp	r3, #0
 1531 0014 01D0     		beq	.L111
 1532              		.loc 1 483 18 discriminator 1
 1533 0016 0423     		movs	r3, #4
 1534 0018 5AE1     		b	.L136
 1535              	.L111:
 484:FATFS/Target/user_diskio_spi.c **** 	if (Stat & STA_NOINIT) return RES_NOTRDY;	/* Check if drive is ready */
 1536              		.loc 1 484 11
 1537 001a AF4B     		ldr	r3, .L144
 1538 001c 1B78     		ldrb	r3, [r3]
 1539 001e DBB2     		uxtb	r3, r3
 1540 0020 03F00103 		and	r3, r3, #1
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 36


 1541              		.loc 1 484 5
 1542 0024 002B     		cmp	r3, #0
 1543 0026 01D0     		beq	.L113
 1544              		.loc 1 484 32 discriminator 1
 1545 0028 0323     		movs	r3, #3
 1546 002a 51E1     		b	.L136
 1547              	.L113:
 485:FATFS/Target/user_diskio_spi.c **** 
 486:FATFS/Target/user_diskio_spi.c **** 	res = RES_ERROR;
 1548              		.loc 1 486 6
 1549 002c 0123     		movs	r3, #1
 1550 002e 87F82F30 		strb	r3, [r7, #47]
 487:FATFS/Target/user_diskio_spi.c **** 
 488:FATFS/Target/user_diskio_spi.c **** 	switch (cmd) {
 1551              		.loc 1 488 2
 1552 0032 BB79     		ldrb	r3, [r7, #6]	@ zero_extendqisi2
 1553 0034 042B     		cmp	r3, #4
 1554 0036 00F23681 		bhi	.L114
 1555 003a 01A2     		adr	r2, .L116
 1556 003c 52F823F0 		ldr	pc, [r2, r3, lsl #2]
 1557              		.p2align 2
 1558              	.L116:
 1559 0040 55000000 		.word	.L119+1
 1560 0044 69000000 		.word	.L118+1
 1561 0048 A7020000 		.word	.L114+1
 1562 004c 15010000 		.word	.L117+1
 1563 0050 0B020000 		.word	.L115+1
 1564              		.p2align 1
 1565              	.L119:
 489:FATFS/Target/user_diskio_spi.c **** 	case CTRL_SYNC :		/* Wait for end of internal write process of the drive */
 490:FATFS/Target/user_diskio_spi.c **** 		if (spiselect()) res = RES_OK;
 1566              		.loc 1 490 7
 1567 0054 FFF7FEFF 		bl	spiselect
 1568 0058 0346     		mov	r3, r0
 1569              		.loc 1 490 6
 1570 005a 002B     		cmp	r3, #0
 1571 005c 00F02781 		beq	.L137
 1572              		.loc 1 490 24 discriminator 1
 1573 0060 0023     		movs	r3, #0
 1574 0062 87F82F30 		strb	r3, [r7, #47]
 491:FATFS/Target/user_diskio_spi.c **** 		break;
 1575              		.loc 1 491 3 discriminator 1
 1576 0066 22E1     		b	.L137
 1577              	.L118:
 492:FATFS/Target/user_diskio_spi.c **** 
 493:FATFS/Target/user_diskio_spi.c **** 	case GET_SECTOR_COUNT :	/* Get drive capacity in unit of sector (DWORD) */
 494:FATFS/Target/user_diskio_spi.c **** 		if ((send_cmd(CMD9, 0) == 0) && rcvr_datablock(csd, 16)) {
 1578              		.loc 1 494 8
 1579 0068 0021     		movs	r1, #0
 1580 006a 0920     		movs	r0, #9
 1581 006c FFF7FEFF 		bl	send_cmd
 1582 0070 0346     		mov	r3, r0
 1583              		.loc 1 494 6
 1584 0072 002B     		cmp	r3, #0
 1585 0074 40F01D81 		bne	.L138
 1586              		.loc 1 494 35 discriminator 1
 1587 0078 07F10C03 		add	r3, r7, #12
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 37


 1588 007c 1021     		movs	r1, #16
 1589 007e 1846     		mov	r0, r3
 1590 0080 FFF7FEFF 		bl	rcvr_datablock
 1591 0084 0346     		mov	r3, r0
 1592              		.loc 1 494 32 discriminator 1
 1593 0086 002B     		cmp	r3, #0
 1594 0088 00F01381 		beq	.L138
 495:FATFS/Target/user_diskio_spi.c **** 			if ((csd[0] >> 6) == 1) {	/* SDC ver 2.00 */
 1595              		.loc 1 495 12
 1596 008c 3B7B     		ldrb	r3, [r7, #12]	@ zero_extendqisi2
 1597              		.loc 1 495 22
 1598 008e 9B09     		lsrs	r3, r3, #6
 1599 0090 DBB2     		uxtb	r3, r3
 1600              		.loc 1 495 7
 1601 0092 012B     		cmp	r3, #1
 1602 0094 11D1     		bne	.L123
 496:FATFS/Target/user_diskio_spi.c **** 				csize = csd[9] + ((WORD)csd[8] << 8) + ((DWORD)(csd[7] & 63) << 16) + 1;
 1603              		.loc 1 496 16
 1604 0096 7B7D     		ldrb	r3, [r7, #21]	@ zero_extendqisi2
 1605 0098 1A46     		mov	r2, r3
 1606              		.loc 1 496 32
 1607 009a 3B7D     		ldrb	r3, [r7, #20]	@ zero_extendqisi2
 1608              		.loc 1 496 36
 1609 009c 1B02     		lsls	r3, r3, #8
 1610              		.loc 1 496 20
 1611 009e 1344     		add	r3, r3, r2
 1612 00a0 1A46     		mov	r2, r3
 1613              		.loc 1 496 56
 1614 00a2 FB7C     		ldrb	r3, [r7, #19]	@ zero_extendqisi2
 1615              		.loc 1 496 66
 1616 00a4 1B04     		lsls	r3, r3, #16
 1617 00a6 03F47C13 		and	r3, r3, #4128768
 1618              		.loc 1 496 42
 1619 00aa 1344     		add	r3, r3, r2
 1620              		.loc 1 496 11
 1621 00ac 0133     		adds	r3, r3, #1
 1622 00ae FB61     		str	r3, [r7, #28]
 497:FATFS/Target/user_diskio_spi.c **** 				*(DWORD*)buff = csize << 10;
 1623              		.loc 1 497 27
 1624 00b0 FB69     		ldr	r3, [r7, #28]
 1625 00b2 9A02     		lsls	r2, r3, #10
 1626              		.loc 1 497 19
 1627 00b4 3B68     		ldr	r3, [r7]
 1628 00b6 1A60     		str	r2, [r3]
 1629 00b8 28E0     		b	.L124
 1630              	.L123:
 498:FATFS/Target/user_diskio_spi.c **** 			} else {					/* SDC ver 1.XX or MMC ver 3 */
 499:FATFS/Target/user_diskio_spi.c **** 				n = (csd[5] & 15) + ((csd[10] & 128) >> 7) + ((csd[9] & 3) << 1) + 2;
 1631              		.loc 1 499 13
 1632 00ba 7B7C     		ldrb	r3, [r7, #17]	@ zero_extendqisi2
 1633              		.loc 1 499 17
 1634 00bc 03F00F03 		and	r3, r3, #15
 1635 00c0 DAB2     		uxtb	r2, r3
 1636              		.loc 1 499 30
 1637 00c2 BB7D     		ldrb	r3, [r7, #22]	@ zero_extendqisi2
 1638              		.loc 1 499 42
 1639 00c4 DB09     		lsrs	r3, r3, #7
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 38


 1640 00c6 DBB2     		uxtb	r3, r3
 1641              		.loc 1 499 23
 1642 00c8 1344     		add	r3, r3, r2
 1643 00ca DAB2     		uxtb	r2, r3
 1644              		.loc 1 499 55
 1645 00cc 7B7D     		ldrb	r3, [r7, #21]	@ zero_extendqisi2
 1646              		.loc 1 499 64
 1647 00ce 5B00     		lsls	r3, r3, #1
 1648 00d0 DBB2     		uxtb	r3, r3
 1649 00d2 03F00603 		and	r3, r3, #6
 1650 00d6 DBB2     		uxtb	r3, r3
 1651              		.loc 1 499 48
 1652 00d8 1344     		add	r3, r3, r2
 1653 00da DBB2     		uxtb	r3, r3
 1654              		.loc 1 499 7
 1655 00dc 0233     		adds	r3, r3, #2
 1656 00de 87F82E30 		strb	r3, [r7, #46]
 500:FATFS/Target/user_diskio_spi.c **** 				csize = (csd[8] >> 6) + ((WORD)csd[7] << 2) + ((WORD)(csd[6] & 3) << 10) + 1;
 1657              		.loc 1 500 17
 1658 00e2 3B7D     		ldrb	r3, [r7, #20]	@ zero_extendqisi2
 1659              		.loc 1 500 21
 1660 00e4 9B09     		lsrs	r3, r3, #6
 1661 00e6 DBB2     		uxtb	r3, r3
 1662 00e8 1A46     		mov	r2, r3
 1663              		.loc 1 500 39
 1664 00ea FB7C     		ldrb	r3, [r7, #19]	@ zero_extendqisi2
 1665              		.loc 1 500 43
 1666 00ec 9B00     		lsls	r3, r3, #2
 1667              		.loc 1 500 27
 1668 00ee 1A44     		add	r2, r2, r3
 1669              		.loc 1 500 62
 1670 00f0 BB7C     		ldrb	r3, [r7, #18]	@ zero_extendqisi2
 1671              		.loc 1 500 71
 1672 00f2 9B02     		lsls	r3, r3, #10
 1673 00f4 03F44063 		and	r3, r3, #3072
 1674              		.loc 1 500 49
 1675 00f8 1344     		add	r3, r3, r2
 1676              		.loc 1 500 78
 1677 00fa 0133     		adds	r3, r3, #1
 1678              		.loc 1 500 11
 1679 00fc FB61     		str	r3, [r7, #28]
 501:FATFS/Target/user_diskio_spi.c **** 				*(DWORD*)buff = csize << (n - 9);
 1680              		.loc 1 501 33
 1681 00fe 97F82E30 		ldrb	r3, [r7, #46]	@ zero_extendqisi2
 1682 0102 093B     		subs	r3, r3, #9
 1683              		.loc 1 501 27
 1684 0104 FA69     		ldr	r2, [r7, #28]
 1685 0106 9A40     		lsls	r2, r2, r3
 1686              		.loc 1 501 19
 1687 0108 3B68     		ldr	r3, [r7]
 1688 010a 1A60     		str	r2, [r3]
 1689              	.L124:
 502:FATFS/Target/user_diskio_spi.c **** 			}
 503:FATFS/Target/user_diskio_spi.c **** 			res = RES_OK;
 1690              		.loc 1 503 8
 1691 010c 0023     		movs	r3, #0
 1692 010e 87F82F30 		strb	r3, [r7, #47]
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 39


 504:FATFS/Target/user_diskio_spi.c **** 		}
 505:FATFS/Target/user_diskio_spi.c **** 		break;
 1693              		.loc 1 505 3
 1694 0112 CEE0     		b	.L138
 1695              	.L117:
 506:FATFS/Target/user_diskio_spi.c **** 
 507:FATFS/Target/user_diskio_spi.c **** 	case GET_BLOCK_SIZE :	/* Get erase block size in unit of sector (DWORD) */
 508:FATFS/Target/user_diskio_spi.c **** 		if (CardType & CT_SD2) {	/* SDC ver 2.00 */
 1696              		.loc 1 508 16
 1697 0114 714B     		ldr	r3, .L144+4
 1698 0116 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1699 0118 03F00403 		and	r3, r3, #4
 1700              		.loc 1 508 6
 1701 011c 002B     		cmp	r3, #0
 1702 011e 31D0     		beq	.L125
 509:FATFS/Target/user_diskio_spi.c **** 			if (send_cmd(ACMD13, 0) == 0) {	/* Read SD status */
 1703              		.loc 1 509 8
 1704 0120 0021     		movs	r1, #0
 1705 0122 8D20     		movs	r0, #141
 1706 0124 FFF7FEFF 		bl	send_cmd
 1707 0128 0346     		mov	r3, r0
 1708              		.loc 1 509 7
 1709 012a 002B     		cmp	r3, #0
 1710 012c 40F0C380 		bne	.L139
 510:FATFS/Target/user_diskio_spi.c **** 				xchg_spi(0xFF);
 1711              		.loc 1 510 5
 1712 0130 FF20     		movs	r0, #255
 1713 0132 FFF7FEFF 		bl	xchg_spi
 511:FATFS/Target/user_diskio_spi.c **** 				if (rcvr_datablock(csd, 16)) {				/* Read partial block */
 1714              		.loc 1 511 9
 1715 0136 07F10C03 		add	r3, r7, #12
 1716 013a 1021     		movs	r1, #16
 1717 013c 1846     		mov	r0, r3
 1718 013e FFF7FEFF 		bl	rcvr_datablock
 1719 0142 0346     		mov	r3, r0
 1720              		.loc 1 511 8
 1721 0144 002B     		cmp	r3, #0
 1722 0146 00F0B680 		beq	.L139
 512:FATFS/Target/user_diskio_spi.c **** 					for (n = 64 - 16; n; n--) xchg_spi(0xFF);	/* Purge trailing data */
 1723              		.loc 1 512 13
 1724 014a 3023     		movs	r3, #48
 1725 014c 87F82E30 		strb	r3, [r7, #46]
 1726              		.loc 1 512 6
 1727 0150 07E0     		b	.L127
 1728              	.L128:
 1729              		.loc 1 512 32 discriminator 3
 1730 0152 FF20     		movs	r0, #255
 1731 0154 FFF7FEFF 		bl	xchg_spi
 1732              		.loc 1 512 28 discriminator 3
 1733 0158 97F82E30 		ldrb	r3, [r7, #46]	@ zero_extendqisi2
 1734 015c 013B     		subs	r3, r3, #1
 1735 015e 87F82E30 		strb	r3, [r7, #46]
 1736              	.L127:
 1737              		.loc 1 512 24 discriminator 1
 1738 0162 97F82E30 		ldrb	r3, [r7, #46]	@ zero_extendqisi2
 1739 0166 002B     		cmp	r3, #0
 1740 0168 F3D1     		bne	.L128
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 40


 513:FATFS/Target/user_diskio_spi.c **** 					*(DWORD*)buff = 16UL << (csd[10] >> 4);
 1741              		.loc 1 513 34
 1742 016a BB7D     		ldrb	r3, [r7, #22]	@ zero_extendqisi2
 1743              		.loc 1 513 39
 1744 016c 1B09     		lsrs	r3, r3, #4
 1745 016e DBB2     		uxtb	r3, r3
 1746 0170 1A46     		mov	r2, r3
 1747              		.loc 1 513 27
 1748 0172 1023     		movs	r3, #16
 1749 0174 03FA02F2 		lsl	r2, r3, r2
 1750              		.loc 1 513 20
 1751 0178 3B68     		ldr	r3, [r7]
 1752 017a 1A60     		str	r2, [r3]
 514:FATFS/Target/user_diskio_spi.c **** 					res = RES_OK;
 1753              		.loc 1 514 10
 1754 017c 0023     		movs	r3, #0
 1755 017e 87F82F30 		strb	r3, [r7, #47]
 515:FATFS/Target/user_diskio_spi.c **** 				}
 516:FATFS/Target/user_diskio_spi.c **** 			}
 517:FATFS/Target/user_diskio_spi.c **** 		} else {					/* SDC ver 1.XX or MMC */
 518:FATFS/Target/user_diskio_spi.c **** 			if ((send_cmd(CMD9, 0) == 0) && rcvr_datablock(csd, 16)) {	/* Read CSD */
 519:FATFS/Target/user_diskio_spi.c **** 				if (CardType & CT_SD1) {	/* SDC ver 1.XX */
 520:FATFS/Target/user_diskio_spi.c **** 					*(DWORD*)buff = (((csd[10] & 63) << 1) + ((WORD)(csd[11] & 128) >> 7) + 1) << ((csd[13] >> 6) 
 521:FATFS/Target/user_diskio_spi.c **** 				} else {					/* MMC */
 522:FATFS/Target/user_diskio_spi.c **** 					*(DWORD*)buff = ((WORD)((csd[10] & 124) >> 2) + 1) * (((csd[11] & 3) << 3) + ((csd[11] & 224) 
 523:FATFS/Target/user_diskio_spi.c **** 				}
 524:FATFS/Target/user_diskio_spi.c **** 				res = RES_OK;
 525:FATFS/Target/user_diskio_spi.c **** 			}
 526:FATFS/Target/user_diskio_spi.c **** 		}
 527:FATFS/Target/user_diskio_spi.c **** 		break;
 1756              		.loc 1 527 3
 1757 0182 98E0     		b	.L139
 1758              	.L125:
 518:FATFS/Target/user_diskio_spi.c **** 				if (CardType & CT_SD1) {	/* SDC ver 1.XX */
 1759              		.loc 1 518 9
 1760 0184 0021     		movs	r1, #0
 1761 0186 0920     		movs	r0, #9
 1762 0188 FFF7FEFF 		bl	send_cmd
 1763 018c 0346     		mov	r3, r0
 518:FATFS/Target/user_diskio_spi.c **** 				if (CardType & CT_SD1) {	/* SDC ver 1.XX */
 1764              		.loc 1 518 7
 1765 018e 002B     		cmp	r3, #0
 1766 0190 40F09180 		bne	.L139
 518:FATFS/Target/user_diskio_spi.c **** 				if (CardType & CT_SD1) {	/* SDC ver 1.XX */
 1767              		.loc 1 518 36 discriminator 1
 1768 0194 07F10C03 		add	r3, r7, #12
 1769 0198 1021     		movs	r1, #16
 1770 019a 1846     		mov	r0, r3
 1771 019c FFF7FEFF 		bl	rcvr_datablock
 1772 01a0 0346     		mov	r3, r0
 518:FATFS/Target/user_diskio_spi.c **** 				if (CardType & CT_SD1) {	/* SDC ver 1.XX */
 1773              		.loc 1 518 33 discriminator 1
 1774 01a2 002B     		cmp	r3, #0
 1775 01a4 00F08780 		beq	.L139
 519:FATFS/Target/user_diskio_spi.c **** 					*(DWORD*)buff = (((csd[10] & 63) << 1) + ((WORD)(csd[11] & 128) >> 7) + 1) << ((csd[13] >> 6) 
 1776              		.loc 1 519 18
 1777 01a8 4C4B     		ldr	r3, .L144+4
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 41


 1778 01aa 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1779 01ac 03F00203 		and	r3, r3, #2
 519:FATFS/Target/user_diskio_spi.c **** 					*(DWORD*)buff = (((csd[10] & 63) << 1) + ((WORD)(csd[11] & 128) >> 7) + 1) << ((csd[13] >> 6) 
 1780              		.loc 1 519 8
 1781 01b0 002B     		cmp	r3, #0
 1782 01b2 12D0     		beq	.L129
 520:FATFS/Target/user_diskio_spi.c **** 				} else {					/* MMC */
 1783              		.loc 1 520 28
 1784 01b4 BB7D     		ldrb	r3, [r7, #22]	@ zero_extendqisi2
 520:FATFS/Target/user_diskio_spi.c **** 				} else {					/* MMC */
 1785              		.loc 1 520 39
 1786 01b6 5B00     		lsls	r3, r3, #1
 1787 01b8 03F07E03 		and	r3, r3, #126
 520:FATFS/Target/user_diskio_spi.c **** 				} else {					/* MMC */
 1788              		.loc 1 520 58
 1789 01bc FA7D     		ldrb	r2, [r7, #23]	@ zero_extendqisi2
 520:FATFS/Target/user_diskio_spi.c **** 				} else {					/* MMC */
 1790              		.loc 1 520 70
 1791 01be D209     		lsrs	r2, r2, #7
 1792 01c0 D2B2     		uxtb	r2, r2
 520:FATFS/Target/user_diskio_spi.c **** 				} else {					/* MMC */
 1793              		.loc 1 520 45
 1794 01c2 1344     		add	r3, r3, r2
 520:FATFS/Target/user_diskio_spi.c **** 				} else {					/* MMC */
 1795              		.loc 1 520 76
 1796 01c4 5A1C     		adds	r2, r3, #1
 520:FATFS/Target/user_diskio_spi.c **** 				} else {					/* MMC */
 1797              		.loc 1 520 89
 1798 01c6 7B7E     		ldrb	r3, [r7, #25]	@ zero_extendqisi2
 520:FATFS/Target/user_diskio_spi.c **** 				} else {					/* MMC */
 1799              		.loc 1 520 94
 1800 01c8 9B09     		lsrs	r3, r3, #6
 1801 01ca DBB2     		uxtb	r3, r3
 520:FATFS/Target/user_diskio_spi.c **** 				} else {					/* MMC */
 1802              		.loc 1 520 100
 1803 01cc 013B     		subs	r3, r3, #1
 520:FATFS/Target/user_diskio_spi.c **** 				} else {					/* MMC */
 1804              		.loc 1 520 81
 1805 01ce 02FA03F3 		lsl	r3, r2, r3
 1806 01d2 1A46     		mov	r2, r3
 520:FATFS/Target/user_diskio_spi.c **** 				} else {					/* MMC */
 1807              		.loc 1 520 20
 1808 01d4 3B68     		ldr	r3, [r7]
 1809 01d6 1A60     		str	r2, [r3]
 1810 01d8 13E0     		b	.L130
 1811              	.L129:
 522:FATFS/Target/user_diskio_spi.c **** 				}
 1812              		.loc 1 522 34
 1813 01da BB7D     		ldrb	r3, [r7, #22]	@ zero_extendqisi2
 522:FATFS/Target/user_diskio_spi.c **** 				}
 1814              		.loc 1 522 46
 1815 01dc 9B10     		asrs	r3, r3, #2
 522:FATFS/Target/user_diskio_spi.c **** 				}
 1816              		.loc 1 522 23
 1817 01de 9BB2     		uxth	r3, r3
 1818 01e0 03F01F03 		and	r3, r3, #31
 522:FATFS/Target/user_diskio_spi.c **** 				}
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 42


 1819              		.loc 1 522 52
 1820 01e4 0133     		adds	r3, r3, #1
 522:FATFS/Target/user_diskio_spi.c **** 				}
 1821              		.loc 1 522 65
 1822 01e6 FA7D     		ldrb	r2, [r7, #23]	@ zero_extendqisi2
 522:FATFS/Target/user_diskio_spi.c **** 				}
 1823              		.loc 1 522 75
 1824 01e8 D200     		lsls	r2, r2, #3
 1825 01ea 02F01802 		and	r2, r2, #24
 522:FATFS/Target/user_diskio_spi.c **** 				}
 1826              		.loc 1 522 88
 1827 01ee F97D     		ldrb	r1, [r7, #23]	@ zero_extendqisi2
 522:FATFS/Target/user_diskio_spi.c **** 				}
 1828              		.loc 1 522 100
 1829 01f0 4909     		lsrs	r1, r1, #5
 1830 01f2 C9B2     		uxtb	r1, r1
 522:FATFS/Target/user_diskio_spi.c **** 				}
 1831              		.loc 1 522 81
 1832 01f4 0A44     		add	r2, r2, r1
 522:FATFS/Target/user_diskio_spi.c **** 				}
 1833              		.loc 1 522 106
 1834 01f6 0132     		adds	r2, r2, #1
 522:FATFS/Target/user_diskio_spi.c **** 				}
 1835              		.loc 1 522 57
 1836 01f8 02FB03F3 		mul	r3, r2, r3
 1837 01fc 1A46     		mov	r2, r3
 522:FATFS/Target/user_diskio_spi.c **** 				}
 1838              		.loc 1 522 20
 1839 01fe 3B68     		ldr	r3, [r7]
 1840 0200 1A60     		str	r2, [r3]
 1841              	.L130:
 524:FATFS/Target/user_diskio_spi.c **** 			}
 1842              		.loc 1 524 9
 1843 0202 0023     		movs	r3, #0
 1844 0204 87F82F30 		strb	r3, [r7, #47]
 1845              		.loc 1 527 3
 1846 0208 55E0     		b	.L139
 1847              	.L115:
 528:FATFS/Target/user_diskio_spi.c **** 
 529:FATFS/Target/user_diskio_spi.c **** 	case CTRL_TRIM :	/* Erase a block of sectors (used when _USE_ERASE == 1) */
 530:FATFS/Target/user_diskio_spi.c **** 		if (!(CardType & CT_SDC)) break;				/* Check if the card is SDC */
 1848              		.loc 1 530 18
 1849 020a 344B     		ldr	r3, .L144+4
 1850 020c 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1851 020e 03F00603 		and	r3, r3, #6
 1852              		.loc 1 530 6
 1853 0212 002B     		cmp	r3, #0
 1854 0214 51D0     		beq	.L140
 531:FATFS/Target/user_diskio_spi.c **** 		if (USER_SPI_ioctl(drv, MMC_GET_CSD, csd)) break;	/* Get CSD */
 1855              		.loc 1 531 7
 1856 0216 07F10C02 		add	r2, r7, #12
 1857 021a FB79     		ldrb	r3, [r7, #7]	@ zero_extendqisi2
 1858 021c 0B21     		movs	r1, #11
 1859 021e 1846     		mov	r0, r3
 1860 0220 FFF7FEFF 		bl	USER_SPI_ioctl
 1861 0224 0346     		mov	r3, r0
 1862              		.loc 1 531 6
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 43


 1863 0226 002B     		cmp	r3, #0
 1864 0228 49D1     		bne	.L141
 532:FATFS/Target/user_diskio_spi.c **** 		if (!(csd[0] >> 6) && !(csd[10] & 0x40)) break;	/* Check if sector erase can be applied to the ca
 1865              		.loc 1 532 12
 1866 022a 3B7B     		ldrb	r3, [r7, #12]	@ zero_extendqisi2
 1867              		.loc 1 532 7
 1868 022c 9B09     		lsrs	r3, r3, #6
 1869 022e DBB2     		uxtb	r3, r3
 1870              		.loc 1 532 6
 1871 0230 002B     		cmp	r3, #0
 1872 0232 04D1     		bne	.L133
 1873              		.loc 1 532 30 discriminator 1
 1874 0234 BB7D     		ldrb	r3, [r7, #22]	@ zero_extendqisi2
 1875              		.loc 1 532 35 discriminator 1
 1876 0236 03F04003 		and	r3, r3, #64
 1877              		.loc 1 532 22 discriminator 1
 1878 023a 002B     		cmp	r3, #0
 1879 023c 41D0     		beq	.L142
 1880              	.L133:
 533:FATFS/Target/user_diskio_spi.c **** 		dp = buff; st = dp[0]; ed = dp[1];				/* Load sector block */
 1881              		.loc 1 533 6
 1882 023e 3B68     		ldr	r3, [r7]
 1883 0240 3B62     		str	r3, [r7, #32]
 1884              		.loc 1 533 17
 1885 0242 3B6A     		ldr	r3, [r7, #32]
 1886 0244 1B68     		ldr	r3, [r3]
 1887 0246 BB62     		str	r3, [r7, #40]
 1888              		.loc 1 533 29
 1889 0248 3B6A     		ldr	r3, [r7, #32]
 1890 024a 5B68     		ldr	r3, [r3, #4]
 1891 024c 7B62     		str	r3, [r7, #36]
 534:FATFS/Target/user_diskio_spi.c **** 		if (!(CardType & CT_BLOCK)) {
 1892              		.loc 1 534 18
 1893 024e 234B     		ldr	r3, .L144+4
 1894 0250 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 1895 0252 03F00803 		and	r3, r3, #8
 1896              		.loc 1 534 6
 1897 0256 002B     		cmp	r3, #0
 1898 0258 05D1     		bne	.L134
 535:FATFS/Target/user_diskio_spi.c **** 			st *= 512; ed *= 512;
 1899              		.loc 1 535 7
 1900 025a BB6A     		ldr	r3, [r7, #40]
 1901 025c 5B02     		lsls	r3, r3, #9
 1902 025e BB62     		str	r3, [r7, #40]
 1903              		.loc 1 535 18
 1904 0260 7B6A     		ldr	r3, [r7, #36]
 1905 0262 5B02     		lsls	r3, r3, #9
 1906 0264 7B62     		str	r3, [r7, #36]
 1907              	.L134:
 536:FATFS/Target/user_diskio_spi.c **** 		}
 537:FATFS/Target/user_diskio_spi.c **** 		if (send_cmd(CMD32, st) == 0 && send_cmd(CMD33, ed) == 0 && send_cmd(CMD38, 0) == 0 && wait_ready
 1908              		.loc 1 537 7
 1909 0266 B96A     		ldr	r1, [r7, #40]
 1910 0268 2020     		movs	r0, #32
 1911 026a FFF7FEFF 		bl	send_cmd
 1912 026e 0346     		mov	r3, r0
 1913              		.loc 1 537 6
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 44


 1914 0270 002B     		cmp	r3, #0
 1915 0272 28D1     		bne	.L143
 1916              		.loc 1 537 35 discriminator 1
 1917 0274 796A     		ldr	r1, [r7, #36]
 1918 0276 2120     		movs	r0, #33
 1919 0278 FFF7FEFF 		bl	send_cmd
 1920 027c 0346     		mov	r3, r0
 1921              		.loc 1 537 32 discriminator 1
 1922 027e 002B     		cmp	r3, #0
 1923 0280 21D1     		bne	.L143
 1924              		.loc 1 537 63 discriminator 2
 1925 0282 0021     		movs	r1, #0
 1926 0284 2620     		movs	r0, #38
 1927 0286 FFF7FEFF 		bl	send_cmd
 1928 028a 0346     		mov	r3, r0
 1929              		.loc 1 537 60 discriminator 2
 1930 028c 002B     		cmp	r3, #0
 1931 028e 1AD1     		bne	.L143
 1932              		.loc 1 537 90 discriminator 3
 1933 0290 47F23050 		movw	r0, #30000
 1934 0294 FFF7FEFF 		bl	wait_ready
 1935 0298 0346     		mov	r3, r0
 1936              		.loc 1 537 87 discriminator 3
 1937 029a 002B     		cmp	r3, #0
 1938 029c 13D0     		beq	.L143
 538:FATFS/Target/user_diskio_spi.c **** 			res = RES_OK;	/* FatFs does not check result of this command */
 1939              		.loc 1 538 8
 1940 029e 0023     		movs	r3, #0
 1941 02a0 87F82F30 		strb	r3, [r7, #47]
 539:FATFS/Target/user_diskio_spi.c **** 		}
 540:FATFS/Target/user_diskio_spi.c **** 		break;
 1942              		.loc 1 540 3
 1943 02a4 0FE0     		b	.L143
 1944              	.L114:
 541:FATFS/Target/user_diskio_spi.c **** 
 542:FATFS/Target/user_diskio_spi.c **** 	default:
 543:FATFS/Target/user_diskio_spi.c **** 		res = RES_PARERR;
 1945              		.loc 1 543 7
 1946 02a6 0423     		movs	r3, #4
 1947 02a8 87F82F30 		strb	r3, [r7, #47]
 1948 02ac 0CE0     		b	.L121
 1949              	.L137:
 491:FATFS/Target/user_diskio_spi.c **** 
 1950              		.loc 1 491 3
 1951 02ae 00BF     		nop
 1952 02b0 0AE0     		b	.L121
 1953              	.L138:
 505:FATFS/Target/user_diskio_spi.c **** 
 1954              		.loc 1 505 3
 1955 02b2 00BF     		nop
 1956 02b4 08E0     		b	.L121
 1957              	.L139:
 527:FATFS/Target/user_diskio_spi.c **** 
 1958              		.loc 1 527 3
 1959 02b6 00BF     		nop
 1960 02b8 06E0     		b	.L121
 1961              	.L140:
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 45


 530:FATFS/Target/user_diskio_spi.c **** 		if (USER_SPI_ioctl(drv, MMC_GET_CSD, csd)) break;	/* Get CSD */
 1962              		.loc 1 530 29
 1963 02ba 00BF     		nop
 1964 02bc 04E0     		b	.L121
 1965              	.L141:
 531:FATFS/Target/user_diskio_spi.c **** 		if (!(csd[0] >> 6) && !(csd[10] & 0x40)) break;	/* Check if sector erase can be applied to the ca
 1966              		.loc 1 531 46
 1967 02be 00BF     		nop
 1968 02c0 02E0     		b	.L121
 1969              	.L142:
 532:FATFS/Target/user_diskio_spi.c **** 		dp = buff; st = dp[0]; ed = dp[1];				/* Load sector block */
 1970              		.loc 1 532 44
 1971 02c2 00BF     		nop
 1972 02c4 00E0     		b	.L121
 1973              	.L143:
 540:FATFS/Target/user_diskio_spi.c **** 
 1974              		.loc 1 540 3
 1975 02c6 00BF     		nop
 1976              	.L121:
 544:FATFS/Target/user_diskio_spi.c **** 	}
 545:FATFS/Target/user_diskio_spi.c **** 
 546:FATFS/Target/user_diskio_spi.c **** 	despiselect();
 1977              		.loc 1 546 2
 1978 02c8 FFF7FEFF 		bl	despiselect
 547:FATFS/Target/user_diskio_spi.c **** 
 548:FATFS/Target/user_diskio_spi.c **** 	return res;
 1979              		.loc 1 548 9
 1980 02cc 97F82F30 		ldrb	r3, [r7, #47]	@ zero_extendqisi2
 1981              	.L136:
 549:FATFS/Target/user_diskio_spi.c **** }
 1982              		.loc 1 549 1 discriminator 2
 1983 02d0 1846     		mov	r0, r3
 1984 02d2 3037     		adds	r7, r7, #48
 1985              		.cfi_def_cfa_offset 8
 1986 02d4 BD46     		mov	sp, r7
 1987              		.cfi_def_cfa_register 13
 1988              		@ sp needed
 1989 02d6 80BD     		pop	{r7, pc}
 1990              	.L145:
 1991              		.align	2
 1992              	.L144:
 1993 02d8 00000000 		.word	Stat
 1994 02dc 00000000 		.word	CardType
 1995              		.cfi_endproc
 1996              	.LFE336:
 1998              		.text
 1999              	.Letext0:
 2000              		.file 2 "c:\\users\\morroway\\appdata\\roaming\\code\\user\\globalstorage\\bmd.stm32-for-vscode\\@
 2001              		.file 3 "c:\\users\\morroway\\appdata\\roaming\\code\\user\\globalstorage\\bmd.stm32-for-vscode\\@
 2002              		.file 4 "Drivers/CMSIS/Device/ST/STM32L4xx/Include/stm32l4p5xx.h"
 2003              		.file 5 "Drivers/STM32L4xx_HAL_Driver/Inc/stm32l4xx_hal_def.h"
 2004              		.file 6 "Drivers/STM32L4xx_HAL_Driver/Inc/stm32l4xx_hal_gpio.h"
 2005              		.file 7 "Drivers/STM32L4xx_HAL_Driver/Inc/stm32l4xx_hal_dma.h"
 2006              		.file 8 "Drivers/STM32L4xx_HAL_Driver/Inc/stm32l4xx_hal_spi.h"
 2007              		.file 9 "Middlewares/Third_Party/FatFs/src/integer.h"
 2008              		.file 10 "Middlewares/Third_Party/FatFs/src/diskio.h"
 2009              		.file 11 "Core/Inc/main.h"
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 46


 2010              		.file 12 "Drivers/STM32L4xx_HAL_Driver/Inc/stm32l4xx_hal.h"
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 47


DEFINED SYMBOLS
                            *ABS*:0000000000000000 user_diskio_spi.c
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:20     .bss.msg_buffer:0000000000000000 $d
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:23     .bss.msg_buffer:0000000000000000 msg_buffer
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:26     .bss.RxBuf:0000000000000000 $d
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:29     .bss.RxBuf:0000000000000000 RxBuf
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:34     .data.Stat:0000000000000000 Stat
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:39     .bss.CardType:0000000000000000 CardType
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:40     .bss.CardType:0000000000000000 $d
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:46     .bss.spiTimerTickStart:0000000000000000 spiTimerTickStart
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:43     .bss.spiTimerTickStart:0000000000000000 $d
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:53     .bss.spiTimerTickDelay:0000000000000000 spiTimerTickDelay
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:50     .bss.spiTimerTickDelay:0000000000000000 $d
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:56     .text.SPI_Timer_On:0000000000000000 $t
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:62     .text.SPI_Timer_On:0000000000000000 SPI_Timer_On
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:99     .text.SPI_Timer_On:0000000000000020 $d
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:105    .text.SPI_Timer_Status:0000000000000000 $t
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:111    .text.SPI_Timer_Status:0000000000000000 SPI_Timer_Status
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:144    .text.SPI_Timer_Status:0000000000000024 $d
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:150    .text.xchg_spi:0000000000000000 $t
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:155    .text.xchg_spi:0000000000000000 xchg_spi
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:192    .text.xchg_spi:0000000000000028 $d
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:197    .text.rcvr_spi_multi:0000000000000000 $t
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:202    .text.rcvr_spi_multi:0000000000000000 rcvr_spi_multi
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:260    .text.xmit_spi_multi:0000000000000000 $t
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:265    .text.xmit_spi_multi:0000000000000000 xmit_spi_multi
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:320    .text.wait_ready:0000000000000000 $t
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:325    .text.wait_ready:0000000000000000 wait_ready
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:386    .text.despiselect:0000000000000000 $t
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:391    .text.despiselect:0000000000000000 despiselect
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:417    .text.despiselect:000000000000001c $d
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:422    .text.spiselect:0000000000000000 $t
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:427    .text.spiselect:0000000000000000 spiselect
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:469    .text.spiselect:0000000000000034 $d
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:474    .text.rcvr_datablock:0000000000000000 $t
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:479    .text.rcvr_datablock:0000000000000000 rcvr_datablock
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:548    .text.xmit_datablock:0000000000000000 $t
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:553    .text.xmit_datablock:0000000000000000 xmit_datablock
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:629    .text.send_cmd:0000000000000000 $t
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:634    .text.send_cmd:0000000000000000 send_cmd
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:790    .text.USER_SPI_initialize:0000000000000000 $t
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:796    .text.USER_SPI_initialize:0000000000000000 USER_SPI_initialize
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:1107   .text.USER_SPI_initialize:00000000000001cc $d
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:1114   .text.USER_SPI_status:0000000000000000 $t
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:1120   .text.USER_SPI_status:0000000000000000 USER_SPI_status
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:1163   .text.USER_SPI_status:0000000000000028 $d
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:1168   .text.USER_SPI_read:0000000000000000 $t
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:1174   .text.USER_SPI_read:0000000000000000 USER_SPI_read
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:1314   .text.USER_SPI_read:00000000000000c4 $d
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:1320   .text.USER_SPI_write:0000000000000000 $t
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:1326   .text.USER_SPI_write:0000000000000000 USER_SPI_write
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:1497   .text.USER_SPI_write:00000000000000f0 $d
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:1503   .text.USER_SPI_ioctl:0000000000000000 $t
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:1509   .text.USER_SPI_ioctl:0000000000000000 USER_SPI_ioctl
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:1559   .text.USER_SPI_ioctl:0000000000000040 $d
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:1564   .text.USER_SPI_ioctl:0000000000000054 $t
C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s:1993   .text.USER_SPI_ioctl:00000000000002d8 $d
ARM GAS  C:\Users\Morroway\AppData\Local\Temp\ccyu3KMp.s 			page 48



UNDEFINED SYMBOLS
HAL_GetTick
HAL_SPI_TransmitReceive
hspi2
HAL_GPIO_WritePin
